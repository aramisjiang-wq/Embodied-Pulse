generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client-user"
}

datasource db {
  provider = "sqlite"
  url      = env("USER_DATABASE_URL")
}

model User {
  id               String         @id @default(uuid())
  userNumber       String         @unique @map("user_number")
  username         String         @unique
  email            String?        @unique
  passwordHash     String?        @map("password_hash")
  avatarUrl        String?        @map("avatar_url")
  bio              String?
  githubId         String?        @unique @map("github_id")
  githubUrl        String?        @map("github_url")
  linkedinUrl      String?        @map("linkedin_url")
  twitterUrl       String?        @map("twitter_url")
  websiteUrl       String?        @map("website_url")
  location         String?
  skills           String?
  interests        String?
  level            Int            @default(1)
  points           Int            @default(0)
  isVip            Boolean        @default(false) @map("is_vip")
  isActive         Boolean        @default(true) @map("is_active")
  lastLoginAt      DateTime?      @map("last_login_at")
  tags             String?
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  role             String?        @default("user")
  identityType     String?        @map("identity_type")
  organizationName String?        @map("organization_name")
  region           String?        @map("region")
  comments         Comment[]
  favorites        Favorite[]
  notifications    Notification[] @ignore
  pointRecords     PointRecord[]
  posts            Post[]
  subscriptions    Subscription[]
  userActions      UserAction[]

  @@map("users")
}

model Paper {
  id            String    @id @default(uuid())
  arxivId       String?   @unique @map("arxiv_id")
  title         String
  authors       String
  abstract      String?
  pdfUrl        String?   @map("pdf_url")
  publishedDate DateTime? @map("published_date")
  citationCount Int       @default(0) @map("citation_count")
  venue         String?
  categories    String?
  viewCount     Int       @default(0) @map("view_count")
  favoriteCount Int       @default(0) @map("favorite_count")
  shareCount    Int       @default(0) @map("share_count")
  isPinned      Boolean   @default(false) @map("is_pinned")
  pinnedAt      DateTime? @map("pinned_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@index([publishedDate(sort: Desc)])
  @@index([viewCount(sort: Desc)])
  @@index([favoriteCount(sort: Desc)])
  @@index([publishedDate(sort: Desc), viewCount(sort: Desc)])
  @@index([isPinned, pinnedAt(sort: Desc)])
  @@map("papers")
}

model Video {
  id            String    @id @default(uuid())
  platform      String
  videoId       String    @map("video_id")
  bvid          String?   @unique
  title         String
  description   String?
  coverUrl      String?   @map("cover_url")
  duration      Int?
  uploader      String?
  uploaderId    String?   @map("uploader_id")
  publishedDate DateTime? @map("published_date")
  playCount     Int       @default(0) @map("play_count")
  likeCount     Int       @default(0) @map("like_count")
  viewCount     Int       @default(0) @map("view_count")
  favoriteCount Int       @default(0) @map("favorite_count")
  tags          String?
  metadata      String?
  isPinned      Boolean   @default(false) @map("is_pinned")
  pinnedAt      DateTime? @map("pinned_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@index([publishedDate(sort: Desc)])
  @@index([viewCount(sort: Desc)])
  @@index([platform])
  @@index([publishedDate(sort: Desc), viewCount(sort: Desc)])
  @@index([isPinned, pinnedAt(sort: Desc)])
  @@map("videos")
}

model BilibiliUploader {
  id          String    @id @default(uuid())
  mid         String    @unique
  name        String
  avatar      String?
  description String?
  tags        String?
  isActive    Boolean   @default(true) @map("is_active")
  lastSyncAt  DateTime? @map("last_sync_at")
  videoCount  Int       @default(0) @map("video_count")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@map("bilibili_uploaders")
}

model GithubRepo {
  id            String    @id @default(uuid())
  repoId        String    @map("repo_id")
  name          String
  fullName      String    @unique @map("full_name")
  owner         String?
  description   String?
  htmlUrl       String?   @map("html_url")
  language      String?
  starsCount    Int       @default(0) @map("stars_count")
  forksCount    Int       @default(0) @map("forks_count")
  issuesCount   Int       @default(0) @map("issues_count")
  topics        String?
  createdDate   DateTime? @map("created_date")
  updatedDate   DateTime? @map("updated_date")
  viewCount     Int       @default(0) @map("view_count")
  favoriteCount Int       @default(0) @map("favorite_count")
  isPinned      Boolean   @default(false) @map("is_pinned")
  pinnedAt      DateTime? @map("pinned_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  addedBy       String?   @map("added_by")
  notifyEnabled Int?      @default(1) @map("notify_enabled")
  lastNotified  String?   @map("last_notified")
  category      String?   @map("category")

  @@index([repoId])
  @@index([category])
  @@index([starsCount(sort: Desc)])
  @@index([updatedDate(sort: Desc)])
  @@index([updatedDate(sort: Desc), starsCount(sort: Desc)])
  @@index([isPinned, pinnedAt(sort: Desc)])
  @@map("github_repos")
}

model Banner {
  id          String   @id @default(uuid())
  title       String
  description String?
  imageUrl    String   @map("image_url")
  linkUrl     String?  @map("link_url")
  order       Int      @default(0)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([order])
  @@map("banners")
}

model Announcement {
  id        String   @id @default(uuid())
  title     String
  content   String
  type      String   @default("info")
  linkUrl   String?  @map("link_url")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([isActive])
  @@map("announcements")
}

model HomeModule {
  id          String   @id @default(uuid())
  name        String   @unique
  title       String
  description String?
  config      String?
  isActive    Boolean  @default(true) @map("is_active")
  order       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([order])
  @@map("home_modules")
}

model HuggingFaceModel {
  id            String    @id @default(uuid())
  fullName      String    @unique @map("full_name")
  description   String?
  task          String?
  downloads     Int       @default(0)
  likes         Int       @default(0)
  lastModified  DateTime? @map("last_modified")
  viewCount     Int       @default(0) @map("view_count")
  favoriteCount Int       @default(0) @map("favorite_count")
  shareCount    Int       @default(0) @map("share_count")
  isPinned      Boolean   @default(false) @map("is_pinned")
  pinnedAt      DateTime? @map("pinned_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  hf_id         String?
  name          String?
  author        String?
  license       String?
  tags          String?
  contentType   String?   @map("content_type")
  category      String?

  @@index([downloads(sort: Desc)])
  @@index([lastModified(sort: Desc)])
  @@index([contentType])
  @@index([category])
  @@index([isPinned, pinnedAt(sort: Desc)])
  @@map("huggingface_models")
}

model Job {
  id            String    @id @default(uuid())
  title         String
  company       String
  location      String?
  salaryMin     Int?      @map("salary_min")
  salaryMax     Int?      @map("salary_max")
  description   String?
  requirements  String?
  status        String    @default("open")
  viewCount     Int       @default(0) @map("view_count")
  favoriteCount Int       @default(0) @map("favorite_count")
  tags          String?
  isPinned      Boolean   @default(false) @map("is_pinned")
  pinnedAt      DateTime? @map("pinned_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  external_id   String?
  company_logo  String?
  experience    String?
  education     String?
  benefits      String?
  apply_url     String?
  apply_count   Int?      @default(0)

  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@index([status, createdAt(sort: Desc)])
  @@index([isPinned, pinnedAt(sort: Desc)])
  @@map("jobs")
}

model News {
  id            String    @id @default(uuid())
  platform      String
  title         String
  url           String    @unique
  score         String?
  description   String?
  publishedDate DateTime? @map("published_date")
  viewCount     Int       @default(0) @map("view_count")
  favoriteCount Int       @default(0) @map("favorite_count")
  shareCount    Int       @default(0) @map("share_count")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@index([publishedDate(sort: Desc)])
  @@index([viewCount(sort: Desc)])
  @@index([platform])
  @@index([createdAt(sort: Desc)])
  @@map("news")
}

model Post {
  id           String    @id @default(uuid())
  userId       String    @map("user_id")
  contentType  String    @map("content_type")
  contentId    String    @map("content_id")
  title        String?
  content      String
  viewCount    Int       @default(0) @map("view_count")
  likeCount    Int       @default(0) @map("like_count")
  commentCount Int       @default(0) @map("comment_count")
  status       String    @default("active")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  images       String?
  tags         String?
  topic_id     String?
  share_count  Int?      @default(0)
  is_featured  Boolean?  @default(false)
  is_top       Boolean?  @default(false)
  comments     Comment[]
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([contentType, contentId])
  @@index([status, createdAt(sort: Desc)])
  @@map("posts")
}

model Comment {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  postId    String   @map("post_id")
  parentId  String?  @map("parent_id")
  content   String
  likeCount Int      @default(0) @map("like_count")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([postId])
  @@index([createdAt(sort: Desc)])
  @@map("comments")
}

model Favorite {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  contentType String   @map("content_type")
  contentId   String   @map("content_id")
  folderId    String?  @map("folder_id")
  createdAt   DateTime @default(now()) @map("created_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, contentType, contentId])
  @@index([userId])
  @@index([contentType, contentId])
  @@map("favorites")
}

model UserAction {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  actionType  String   @map("action_type")
  contentType String   @map("content_type")
  contentId   String   @map("content_id")
  metadata    String?
  createdAt   DateTime @default(now()) @map("created_at")
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId, actionType])
  @@index([contentType, contentId])
  @@index([createdAt(sort: Desc)])
  @@map("user_actions")
}

model PointRecord {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  points      Int
  actionType  String   @map("action_type")
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([createdAt(sort: Desc)])
  @@map("point_records")
}

model Subscription {
  id            String                @id @default(uuid())
  userId        String                @map("user_id")
  contentType   String                @map("content_type")
  keywords      String?
  tags          String?
  authors       String?
  uploaders     String?
  platform      String?
  isPublic      Boolean               @default(false) @map("is_public")
  isActive      Boolean               @default(true) @map("is_active")
  notifyEnabled Boolean               @default(true) @map("notify_enabled")
  syncEnabled   Boolean               @default(true) @map("sync_enabled")
  newCount      Int                   @default(0) @map("new_count")
  totalMatched  Int                   @default(0) @map("total_matched")
  lastNotified  DateTime?             @map("last_notified")
  lastChecked   DateTime?             @map("last_checked")
  lastSyncAt    DateTime?             @map("last_sync_at")
  createdAt     DateTime              @default(now()) @map("created_at")
  updatedAt     DateTime              @updatedAt @map("updated_at")
  history       SubscriptionHistory[]
  user          User                  @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([contentType])
  @@index([isActive])
  @@index([isPublic])
  @@index([syncEnabled])
  @@map("subscriptions")
}

model SubscriptionHistory {
  id             String       @id @default(uuid())
  subscriptionId String       @map("subscription_id")
  syncType       String       @map("sync_type")
  matchedCount   Int          @default(0) @map("matched_count")
  newCount       Int          @default(0) @map("new_count")
  status         String       @default("success")
  errorMessage   String?      @map("error_message")
  duration       Int?
  metadata       String?
  createdAt      DateTime     @default(now()) @map("created_at")
  subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
  @@index([createdAt(sort: Desc)])
  @@map("subscription_history")
}

model NewsKeywordFilter {
  id              String   @id @default(uuid())
  name            String   @unique
  description     String?
  keywords        String?
  excludeKeywords String?  @map("exclude_keywords")
  matchType       String   @default("all") @map("match_type")
  caseSensitive   Boolean  @default(false) @map("case_sensitive")
  isActive        Boolean  @default(true) @map("is_active")
  priority        Int      @default(0)
  applyToPlatform String?  @map("apply_to_platform")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@index([isActive])
  @@index([priority(sort: Desc)])
  @@map("news_keyword_filters")
}

model NewsSourceConfig {
  id            String    @id @default(uuid())
  platform      String    @unique
  name          String
  baseUrl       String    @map("base_url")
  searchUrl     String?   @map("search_url")
  listUrl       String?   @map("list_url")
  headers       String?
  params        String?
  isActive      Boolean   @default(true) @map("is_active")
  syncEnabled   Boolean   @default(true) @map("sync_enabled")
  syncInterval  Int       @default(3600) @map("sync_interval")
  lastSyncAt    DateTime? @map("last_sync_at")
  lastSuccessAt DateTime? @map("last_success_at")
  totalItems    Int       @default(0) @map("total_items")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@index([isActive])
  @@index([syncEnabled])
  @@map("news_source_configs")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model Notification {
  id          String? @id @default(uuid())
  userId      String  @map("user_id")
  type        String
  title       String
  content     String?
  contentType String? @map("content_type")
  contentId   String? @map("content_id")
  metadata    String?
  isRead      Int?    @default(0) @map("is_read")
  readAt      String? @map("read_at")
  createdAt   String  @default("CURRENT_TIMESTAMP") @map("created_at")
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId])
  @@index([type])
  @@index([isRead])
  @@index([createdAt(sort: Desc)])
  @@map("notifications")
  @@ignore
}

model PasswordReset {
  id        String   @id @default(uuid())
  email     String
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  used      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")

  @@index([email])
  @@index([token])
  @@map("password_resets")
}

model EmailVerification {
  id        String   @id @default(uuid())
  email     String
  code      String
  type      String
  expiresAt DateTime @map("expires_at")
  used      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")

  @@index([email])
  @@index([code])
  @@map("email_verifications")
}

model custom_pages {
  id         String   @id
  slug       String   @unique
  title      String
  content    String
  is_active  Boolean  @default(true)
  sort_order Int      @default(0)
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([sort_order])
  @@index([is_active])
}

model DailyNews {
  id        String   @id @default(uuid())
  date      String
  title     String
  content   String
  isPinned  Boolean  @default(false) @map("is_pinned")
  pinnedAt  DateTime? @map("pinned_at")
  viewCount Int      @default(0) @map("view_count")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([date(sort: Desc)])
  @@index([isPinned, pinnedAt(sort: Desc)])
  @@map("daily_news")
}

model admin_audit_logs {
  id         String   @id
  admin_id   String
  action     String
  target     String?
  details    String?
  ip         String?
  created_at DateTime @default(now())

  @@index([action])
  @@index([created_at(sort: Desc)])
  @@index([admin_id])
}

model bilibili_cookie_settings {
  id                    String   @id
  auto_rotate_enabled   Boolean  @default(false)
  health_check_interval Int      @default(60)
  max_error_count       Int      @default(3)
  alert_enabled         Boolean  @default(true)
  updated_at            DateTime
}

model bilibili_cookies {
  id            String    @id
  name          String
  cookie        String
  priority      Int       @default(0)
  is_active     Boolean   @default(true)
  error_count   Int       @default(0)
  last_error    String?
  last_used_at  DateTime?
  last_check_at DateTime?
  check_result  String?
  user_mid      String?
  user_name     String?
  source        String    @default("manual")
  created_at    DateTime  @default(now())
  updated_at    DateTime

  @@index([priority])
  @@index([is_active])
}

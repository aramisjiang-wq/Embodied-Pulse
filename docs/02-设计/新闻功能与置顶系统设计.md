# 新闻功能与置顶系统设计

**文档版本**: v1.0
**创建日期**: 2026-02-24
**最后更新**: 2026-02-24
**维护人**: AI助手团队

---

## 一、功能概述

### 1.1 背景

用户需要在平台新增新闻功能，每日发布具身智能领域动态，同时希望这些内容能够在首页发现模块获得更多曝光。

### 1.2 核心需求

| 功能点 | 说明 |
|--------|------|
| **新闻管理** | 管理端新增新闻管理，支持富文本编辑，每天一条记录 |
| **置顶功能** | 所有内容类型支持置顶，管理端可配置 |
| **新闻标签** | 发现模块新增"新闻"标签，展示新闻列表 |
| **置顶展示** | "全部"标签下展示置顶内容（新闻+其他置顶内容） |

### 1.3 设计原则

- **复用性**：置顶功能适用于所有内容类型，不仅限于新闻
- **简洁性**：新闻采用富文本存储，符合用户"粘贴复制"的操作习惯
- **一致性**：遵循现有项目架构和代码规范

---

## 二、数据模型设计

### 2.1 新增 News 表

```prisma
model News {
  id          String   @id @default(uuid())
  date        DateTime @db.Date          // 新闻日期（如 2026-02-23）
  title       String                      // 标题（如 "（2月23日）具身智能领域动态"）
  content     String   @db.Text          // 富文本内容（Markdown格式）
  isPinned    Boolean  @default(false)   // 是否置顶
  pinnedAt    DateTime?                   // 置顶时间
  viewCount   Int      @default(0)       // 浏览量
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([date])
  @@index([isPinned, pinnedAt])
}
```

### 2.2 现有表增加置顶字段

需要修改以下表，每个表增加两个字段：

| 表名 | 新增字段 |
|------|----------|
| Paper | isPinned, pinnedAt |
| Video | isPinned, pinnedAt |
| GithubRepo | isPinned, pinnedAt |
| HuggingFaceModel | isPinned, pinnedAt |
| Job | isPinned, pinnedAt |

字段定义：
```prisma
isPinned    Boolean  @default(false)   // 是否置顶
pinnedAt    DateTime?                   // 置顶时间
```

---

## 三、API设计

### 3.1 用户端 API

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/news | 新闻列表（分页，按日期倒序） |
| GET | /api/news/:id | 新闻详情（增加浏览量） |
| GET | /api/news/pinned | 获取置顶新闻列表 |

### 3.2 管理端 API

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/admin/content/news | 新闻列表（管理端） |
| POST | /api/admin/content/news | 创建新闻 |
| PUT | /api/admin/content/news/:id | 更新新闻 |
| DELETE | /api/admin/content/news/:id | 删除新闻 |
| PUT | /api/admin/content/:type/:id/pin | 置顶/取消置顶（通用） |

### 3.3 发现模块 API 修改

修改现有 `/api/discovery` 接口，增加置顶内容返回：

```typescript
// 响应结构
{
  pinnedItems: FeedItem[],      // 置顶内容
  items: FeedItem[],            // 常规内容流
  total: number,
  page: number,
  size: number
}
```

---

## 四、前端页面设计

### 4.1 用户端页面

#### 4.1.1 新闻列表页 `/news`

- 展示所有新闻，按日期倒序
- 每条新闻显示：日期、标题、摘要
- 支持分页

#### 4.1.2 新闻详情页 `/news/[id]`

- 展示完整新闻内容（Markdown渲染）
- 显示浏览量
- 支持分享

#### 4.1.3 发现模块修改

**标签栏新增"新闻"：**
```
[全部] [论文] [GitHub] [HuggingFace] [视频] [市集] [新闻]
```

**置顶区展示逻辑：**

| 当前标签 | 置顶区内容 |
|----------|------------|
| 全部 | 所有类型的置顶内容（包括新闻） |
| 新闻 | 置顶的新闻 |
| 论文/GitHub/视频等 | 该类型的置顶内容 |

### 4.2 管理端页面

#### 4.2.1 新闻管理

在 `/admin/content` 页面新增"新闻"Tab：
- 表格展示新闻列表
- 支持创建、编辑、删除
- 编辑器：Markdown富文本编辑器

#### 4.2.2 置顶操作

所有内容列表增加"置顶"按钮：
- 点击切换置顶状态
- 置顶内容在列表中标记显示

---

## 五、展示效果

### 5.1 发现模块布局

```
┌─────────────────────────────────────────────────────────────┐
│  发现模块                                                    │
├─────────────────────────────────────────────────────────────┤
│  [全部] [论文] [GitHub] [HuggingFace] [视频] [市集] [新闻]   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【全部标签 - 置顶区】                                        │
│  ┌─── 置顶内容（可展开/收起）────────────────────────────┐   │
│  │ 📰 2月23日具身智能领域动态              [展开/收起]    │   │
│  │    融资动态 3条 | 技术突破 3条 | 应用落地 4条...       │   │
│  │                                                       │   │
│  │ 📄 置顶论文标题                             [查看]    │   │
│  │ 🎬 置顶视频标题                             [查看]    │   │
│  └───────────────────────────────────────────────────────┘   │
│                                                             │
│  ──────────── 常规内容流 ────────────                       │
│  [论文卡片] [GitHub卡片] [视频卡片] ...                      │
│                                                             │
│  【新闻标签】                                                │
│  新闻列表（按日期倒序）                                       │
│                                                             │
│  【其他标签】                                                │
│  该类型的置顶内容 + 常规内容流                                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 新闻卡片展开效果

```
┌─────────────────────────────────────────────────────────────┐
│ 📰 2月23日具身智能领域动态                      [收起]      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 【融资动态】                                                 │
│ 1. 智平方完成超10亿B轮融资，估值破百亿                        │
│    来源：腾讯证券 | 时间：11:10                              │
│    观点：深圳南山具身智能企业智平方完成B轮系列融资...          │
│                                                             │
│ 2. 智平方一年内完成12轮融资，创行业纪录                       │
│    来源：东方财富网 | 时间：00:00                            │
│    观点：继2025年完成7轮融资后...                            │
│                                                             │
│ 【技术突破】                                                 │
│ 3. 智平方自研GOVLA大模型，实现全域全身控制                    │
│    ...                                                      │
│                                                             │
│ [查看完整内容 →]                                            │
└─────────────────────────────────────────────────────────────┘
```

---

## 六、开发任务清单

### 6.1 后端任务

| 序号 | 任务 | 优先级 |
|------|------|--------|
| 1 | 数据库：新增 News 表 | 高 |
| 2 | 数据库：现有表增加置顶字段 | 高 |
| 3 | 后端：新闻 CRUD API | 高 |
| 4 | 后端：置顶 API（通用） | 高 |
| 5 | 后端：修改发现模块 API 支持置顶内容 | 高 |

### 6.2 前端任务

| 序号 | 任务 | 优先级 |
|------|------|--------|
| 1 | 管理端：新闻管理页面 | 高 |
| 2 | 管理端：所有内容列表增加置顶操作 | 高 |
| 3 | 用户端：新闻列表页和详情页 | 高 |
| 4 | 用户端：发现模块新增新闻标签 | 高 |
| 5 | 用户端：发现模块置顶区组件 | 高 |

---

## 七、注意事项

### 7.1 开发顺序

按照项目规范，严格遵循：
1. 用户端 → 管理端
2. 后端 → 前端
3. 开发完成后进行一致性校验

### 7.2 颜色规范

用户端和管理端的 Banner、按钮背景禁止使用紫色，推荐使用蓝色渐变。

### 7.3 代码规范

- 使用 TypeScript 严格类型检查
- 遵循现有项目代码风格
- 添加必要的注释

---

## 八、验收标准

### 8.1 功能验收

- [ ] 管理端可以创建、编辑、删除新闻
- [ ] 管理端可以对任何内容进行置顶/取消置顶操作
- [ ] 用户端新闻列表页正常展示
- [ ] 用户端新闻详情页正常展示
- [ ] 发现模块"新闻"标签正常工作
- [ ] 发现模块置顶区正常展示置顶内容
- [ ] 置顶内容按置顶时间倒序排列

### 8.2 性能验收

- [ ] 新闻列表加载时间 < 1秒
- [ ] 置顶内容不影响常规内容流加载

### 8.3 兼容性验收

- [ ] 不影响现有功能正常运行
- [ ] 移动端适配正常

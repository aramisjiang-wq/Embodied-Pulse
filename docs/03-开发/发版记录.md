# Embodied Pulse 发版记录

**文档版本**: v3.1
**创建日期**: 2026-02-23
**最后更新**: 2026-02-24

---

## 版本历史

### v3.6.0 (2026-02-24)

**类型**: 功能优化 + Bug修复

**Bug修复**:
- 🐛 修复用户积分与等级不一致问题
  - 问题原因：用户填写组织名称后直接设置 level=3，但积分未同步增加
  - 解决方案：创建修复脚本，为已填写组织名称但积分不足的用户补足300积分
  - 影响用户：2个用户数据已修复
  - 等级计算规则：L3需要300-599积分

**优化改进**:
- 🎨 置顶内容卡片 UI/UX 全面优化
  - 卡片式设计，每个置顶项独立展示
  - 支持单独展开/收起，一键查看完整内容
  - 移除滚动条，内容完整展示，提升阅读体验
  - 优化标题、描述、来源信息的排版布局

- 🎨 HuggingFace 标签按钮样式优化
  - 添加 `whiteSpace: 'nowrap'` 防止图标和文字换行
  - 添加 flex 布局确保内容居中对齐
  - 提升按钮视觉一致性

- ✨ 管理端新闻配置支持富文本编辑
  - 集成 wangeditor 富文本编辑器
  - 支持文本格式化（加粗、斜体、下划线等）
  - 支持列表、引用、代码块
  - 支持图片、链接插入
  - 新增内容预览功能

**涉及文件**:

后端：
- `backend/src/scripts/fix-user-points-level.ts` - 新增用户积分修复脚本

前端：
- `frontend/src/components/PinnedItems.tsx` - 置顶内容组件重构
- `frontend/src/components/DiscoveryModule.tsx` - HuggingFace 标签样式优化
- `frontend/src/components/RichTextEditor.tsx` - 新增富文本编辑器组件
- `frontend/src/app/admin/news/page.tsx` - 新闻管理页面集成富文本编辑器
- `frontend/src/app/admin/content/huggingface/page.tsx` - 修复 TextArea 导入问题

**验证结果**:
- ✅ 用户积分与等级数据一致性已修复
- ✅ 置顶内容卡片展示完整，无滚动条
- ✅ HuggingFace 标签按钮图标文字同行显示
- ✅ 管理端新闻配置富文本编辑器正常工作

---

### v3.5.9 (2026-02-24)

**类型**: Bug修复

**问题描述**:
- 管理后台管理员页面点击"审计日志"按钮返回 404 错误
- API 路径 `/api/v1/admin/admins/:adminId/audit-logs` 未实现

**Bug修复**:
- 🐛 修复管理员审计日志 API 缺失问题
  - 新增 `AdminAuditLog` 数据库模型
  - 新增审计日志服务 `admin-audit.service.ts`
  - 新增审计日志 API 端点 `GET /admin/admins/:adminId/audit-logs`

**新增功能**:
- ✨ 管理员审计日志系统
  - 支持记录管理员操作（登录、权限变更、用户管理等）
  - 支持按管理员 ID 查询审计日志
  - 支持分页查询

**数据库变更**:
- 新增 `admin_audit_logs` 表
  - `admin_id` - 管理员ID
  - `action` - 操作类型
  - `target` - 操作对象
  - `details` - 操作详情（JSON）
  - `ip` - IP地址
  - `created_at` - 创建时间

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/admin/admins/:adminId/audit-logs` | GET | 获取管理员审计日志 |

**涉及文件**:

后端：
- `backend/prisma/schema.prisma` - 新增 AdminAuditLog 模型
- `backend/src/services/admin-audit.service.ts` - 新增审计日志服务
- `backend/src/controllers/admin.controller.ts` - 新增审计日志控制器
- `backend/src/routes/admin.routes.ts` - 新增审计日志路由

**管理员页面功能验证**:

| 按钮 | API路由 | 状态 |
|------|---------|------|
| 搜索管理员 | `GET /admin/admins` | ✅ |
| 新增管理员 | `POST /admin/admins` | ✅ |
| 权限配置 | `PUT /admin/admins/:adminId/permissions` | ✅ |
| 编辑标签 | `POST /admin/admins/:adminId/tags` | ✅ |
| 审计日志 | `GET /admin/admins/:adminId/audit-logs` | ✅ 已修复 |

---

### v3.5.8 (2026-02-24)

**类型**: Bug修复

**问题描述**:
- 首页发现模块"全部"标签下置顶的新闻不显示
- 前端 API 类型定义缺少 `'news'` 类型，导致 TypeScript 类型不匹配

**Bug修复**:
- 🐛 修复前端 discovery API 类型定义缺少 `'news'` 类型
  - 问题原因：`discovery.ts` 中 `contentType` 类型定义缺少 `'news'`
  - 解决方案：添加 `'news'` 到 `contentType` 类型定义
  - 同时添加 `pinnedItems` 到返回类型

- 🐛 修复 DiscoveryItem 接口缺少置顶相关字段
  - 问题原因：`DiscoveryItem` 接口缺少 `contentType`、`isPinned`、`pinnedAt` 字段
  - 解决方案：补充缺失的字段定义

**涉及文件**:
- `frontend/src/lib/api/discovery.ts` - 添加 `'news'` 类型和 `pinnedItems` 返回类型
- `frontend/src/components/DiscoveryModule.tsx` - 补充 `DiscoveryItem` 接口字段

**验证结果**:
- ✅ API 返回 `pinnedItems` 数组，包含置顶新闻
- ✅ 首页发现模块"全部"和"新闻"标签正确显示置顶内容

---

### v3.5.8 (2026-02-24)

**类型**: 功能新增 + 数据补充

**功能新增**:
- ✨ HuggingFace资源页面分类数量显示
  - 侧边栏分类按钮旁边显示对应资源数量
  - 内容类型（模型/数据集）显示统计数量
  - 模型分类和数据集分类各子分类显示数量
  - 便于用户快速了解各分类资源规模

**数据补充**:
- 📊 HuggingFace资源数据大规模补充
  - 修复导入脚本标题匹配问题（支持无顿号格式如"二十一人形机器人数据集"）
  - 补充文档中缺失分类的HuggingFace资源
  - 补充多个前端定义但数据库为空的分类
  - 所有分类现在都有≥10个资源
  
- 📈 最终数据统计:
  - 总资源数: 735条
  - 模型: 217个
  - 数据集: 518个
  - 分类: 41个（全部≥10个资源）

**补充的分类资源**:
| 分类 | 数量 |
|------|------|
| simulation-datasets | 165 |
| other-robot-models | 76 |
| lerobot-datasets | 34 |
| humanoid-datasets | 31 |
| navigation-datasets | 29 |
| libero-datasets | 27 |
| aloha-datasets | 24 |
| vision-models | 21 |
| vla-models | 17 |
| manipulation-datasets | 12 |
| 其他33个分类 | 各10个 |

**修复的Bug**:
- 🐛 统计API修复
  - 问题：统计API只按task字段统计，contentType和category未统计
  - 解决方案：getTaskTypeStats函数添加contentType和category统计
  
- 🐛 前端页面初始化问题
  - 问题：loadTaskStats只在筛选条件变化时调用，页面初始不加载
  - 解决方案：分离useEffect，页面加载时自动获取统计数据

**涉及文件**:
- `backend/src/services/huggingface.service.ts` - 统计API修复
- `frontend/src/app/huggingface/page.tsx` - 数量显示 + useEffect修复
- `frontend/src/app/huggingface/page.module.css` - 分类数量样式
- `backend/src/scripts/import-huggingface-resources.ts` - 导入脚本修复
- `backend/src/scripts/supplement-huggingface-resources*.ts` - 补充导入脚本

---

### v3.5.7 (2026-02-24)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复 HuggingFace 管理页面组件导入错误
  - 问题原因：缺少 `InputNumber` 和 `TextArea` 组件导入
  - 解决方案：从 antd 正确导入 `InputNumber` 和 `TextArea`

**涉及文件**:
- `frontend/src/app/admin/content/huggingface/page.tsx` - 修复组件导入

---

### v3.5.6 (2026-02-24)

**类型**: 功能新增

**新增功能**:
- ✨ GitHub项目分类补充功能：管理端可从GitHub搜索新项目并按分类添加
  - 为每个分类定义智能搜索关键词（基于资源清单文档）
  - 支持查看每个分类可补充的项目数量
  - 支持批量选择、批量添加项目
  - 自动过滤已存在的项目，避免重复添加
  - 只补充 Stars≥100 的高质量项目

**管理端功能**:
- 📦 新增"分类补充"按钮，位于项目管理页面顶部
- 📊 显示各分类可补充项目数量统计
- ✅ 支持全选/单选，批量添加选中的项目
- 🔗 可直接跳转GitHub查看项目详情

**用户端优化**:
- 🔄 GitHub项目页面默认排序改为"最近更新"，便于用户发现最新项目

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/admin/repos/suggestions/stats` | GET | 获取各分类候选项目统计 |
| `/api/admin/repos/suggestions/:category` | GET | 搜索指定分类的候选项目 |
| `/api/admin/repos/batch` | POST | 批量添加仓库 |

**涉及文件**:

后端：
- `backend/src/services/repo-category-search.service.ts` - 新增分类搜索服务
- `backend/src/controllers/admin.controller.ts` - 新增分类补充控制器
- `backend/src/routes/admin.routes.ts` - 新增API路由

前端：
- `frontend/src/app/admin/content/repos/page.tsx` - 新增分类补充弹窗

**分类搜索关键词映射**:
- 1.1 VLA: `VLA vision-language-action robot`, `OpenVLA robot policy` 等
- 1.2 模仿学习: `imitation learning robot`, `ACT ALOHA diffusion policy` 等
- 1.3 强化学习: `reinforcement learning robot`, `PPO SAC robot` 等
- ... (共25个子分类)

**使用说明**:
1. 登录管理后台
2. 进入"内容管理" → "GitHub项目"
3. 点击"分类补充"按钮
4. 选择要补充的分类
5. 勾选要添加的项目
6. 点击"添加选中的项目"

**备注**:
- 搜索结果自动过滤已存在的项目
- 每个分类最多显示30个候选项目
- 搜索关键词基于资源清单文档定义，确保相关性

---

### v3.5.5 (2026-02-24)

**类型**: Bug修复

**问题描述**:
- 管理端新增首页模块失败，API 返回 401 Unauthorized "未提供Token"
- 获取模块列表也返回 401 错误

**Bug修复**:
- 🐛 修复管理端首页模块 API 认证失败问题
  - 问题原因：`client.ts` 中 `isPublicApi` 包含 `/home-modules`，导致管理端请求时不携带管理员 token
  - 解决方案：将 `/home-modules` 从 `isPublicApi` 中移除，由 `isAdminOnlyApi` 判断是否需要管理员权限

**涉及文件**:
- `frontend/src/lib/api/client.ts` - 修复 API 认证逻辑

**修复后逻辑**:
- GET /home-modules → 公开API（用户端展示活跃模块）
- GET /home-modules/all → 需要 admin_token（管理端查看）
- POST /home-modules → 需要 admin_token（新增模块）
- PUT/DELETE /home-modules/:id → 需要 admin_token（更新/删除）

**验证结果**:
- ✅ 管理端页面可以正常获取模块列表
- ✅ 管理端可以正常新增/编辑/删除模块

---

### v3.5.4 (2026-02-24)

**类型**: 功能新增

**新增功能**:
- ✨ 管理端新增独立的新闻管理页面 `/admin/news`
  - 支持新闻的创建、编辑、删除操作
  - 支持一键置顶/取消置顶
  - 支持分页浏览
  - 支持富文本（Markdown）格式内容

**UI改进**:
- 🎨 管理端侧边栏新增"新闻管理"菜单项
- 🎨 新闻管理页面与项目设计规范统一

**涉及文件**:
- `frontend/src/app/admin/news/page.tsx` - 新增新闻管理页面
- `frontend/src/app/admin/layout.tsx` - 侧边栏添加新闻管理菜单

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/admin/content/news` | GET | 新闻列表 |
| `/api/admin/content/news` | POST | 创建新闻 |
| `/api/admin/content/news/:id` | PUT | 更新新闻 |
| `/api/admin/content/news/:id` | DELETE | 删除新闻 |
| `/api/admin/content/news/:id/pin` | PUT | 切换置顶状态 |

**使用说明**:
1. 登录管理后台
2. 点击侧边栏"内容管理" → "新闻管理"
3. 点击"新增新闻"按钮创建新闻
4. 填写日期、标题、内容（支持 Markdown 格式）
5. 可选择是否置顶显示

---

### v3.5.3 (2026-02-24)

**类型**: 功能优化

**优化改进**:
- 🎨 HuggingFace 管理页面全面优化，提供完整的数据管理功能
  - 模型列表 Tab 新增：新增、编辑、删除、查看详情功能
  - 支持关键词搜索、内容类型筛选（模型/数据集/Space）、任务类型筛选、排序
  - 新增详情抽屉，展示完整模型信息
  - 新增统计卡片：模型总数、数据集数量、Spaces数量、本月新增
- 🎨 统一页面设计风格，与论文管理页面保持一致

**涉及文件**:
- `frontend/src/app/admin/content/huggingface/page.tsx` - 页面组件重构
- `frontend/src/app/admin/content/huggingface/page.module.css` - 样式文件

**功能说明**:
- 模型列表：展示所有 HuggingFace 模型/数据集/Space，支持完整的 CRUD 操作
- 作者订阅：保留原有订阅管理功能

---

### v3.5.2 (2026-02-24)

**类型**: Bug修复

**问题描述**:
1. 页面无数据显示，API返回空数据但数据库有数据
2. Prisma Schema 与数据库表结构不一致，缺少 `is_pinned` 和 `pinned_at` 字段
3. Prisma 客户端生成失败，`Notification` 模型关系字段未正确忽略

**Bug修复**:
- 🐛 修复数据库表结构不一致问题
  - 问题原因：数据库表中缺少 `is_pinned` 和 `pinned_at` 字段
  - 解决方案：为 `papers`、`videos`、`github_repos`、`huggingface_models`、`jobs` 表添加缺失字段
  - 错误信息：`The column main.papers.is_pinned does not exist in the current database`

- 🐛 修复 Prisma Schema 关系字段未正确忽略问题
  - 问题原因：`Notification` 模型有 `@@ignore` 指令，但 `User` 模型中的 `notifications` 关系字段缺少 `@ignore` 属性
  - 解决方案：为 `notifications` 字段添加 `@ignore` 属性

**涉及文件**:
- `backend/prisma/schema.user.prisma` - 修复 User 模型 notifications 字段
- `backend/prisma/dev-user.db` - 数据库表结构修复（添加 is_pinned、pinned_at 字段）

**数据库变更**:
```sql
-- 为各表添加置顶相关字段
ALTER TABLE papers ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE papers ADD COLUMN pinned_at DATETIME;
ALTER TABLE videos ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE videos ADD COLUMN pinned_at DATETIME;
ALTER TABLE github_repos ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE github_repos ADD COLUMN pinned_at DATETIME;
ALTER TABLE huggingface_models ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE huggingface_models ADD COLUMN pinned_at DATETIME;
ALTER TABLE jobs ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE jobs ADD COLUMN pinned_at DATETIME;
```

**验证结果**:
- ✅ API 正常返回数据
- ✅ 统计数据：papers: 1661, videos: 736, repos: 363, huggingface: 493, jobs: 95
- ✅ 发现页正常展示混合内容

**备注**:
- 此问题由 v3.5.0 版本新增置顶功能时数据库迁移未完成导致
- 建议后续使用 Prisma Migration 管理数据库变更，避免手动修改

---

### v3.5.1 (2026-02-24)

**类型**: Bug修复 + UI优化

**Bug修复**:
- 🐛 修复新闻页面 API 导入错误
  - 问题原因：`daily-news.ts` 错误导入了不存在的 `cachedClient` 对象
  - 解决方案：改为正确导入 `cachedGet` 函数和 `apiClient`
  - 影响文件：`frontend/src/lib/api/daily-news.ts`

**优化改进**:
- 🎨 新闻列表页 UI 重构，与项目设计规范统一
  - 使用 `PageContainer` 组件保持页面一致性
  - 采用与 papers 页面相同的双栏布局设计
  - 统一的卡片样式、分页组件和响应式设计
- 🎨 新闻详情页 UI 重构
  - 统一的详情页布局和样式
  - 规范化的内容渲染

**涉及文件**:
- `frontend/src/lib/api/daily-news.ts` - 修复 API 导入错误
- `frontend/src/app/news/page.tsx` - 列表页重构
- `frontend/src/app/news/page.module.css` - 新增列表页样式
- `frontend/src/app/news/[id]/page.tsx` - 详情页重构
- `frontend/src/app/news/[id]/page.module.css` - 新增详情页样式

**备注**:
- 新闻页面现在与论文、视频等其他页面保持一致的设计风格
- 浅色背景 + 白色卡片 + 蓝色主题色

---

### v3.5.0 (2026-02-24)

**类型**: 功能新增

**新增功能**:
- ✨ 每日新闻功能：管理端可发布每日新闻，支持富文本（Markdown）格式
- ✨ 通用置顶系统：所有内容类型（论文、视频、GitHub、HuggingFace、招聘、新闻）支持置顶
- ✨ 发现模块增强：新增"新闻"标签，置顶内容区展示

**用户端功能**:
- 📰 新闻列表页 `/news` - 按日期倒序展示所有新闻
- 📰 新闻详情页 `/news/[id]` - 展示完整新闻内容
- 📌 发现模块置顶区 - 展示置顶的新闻和其他内容
- 🏷️ 发现模块新增"新闻"标签 - 专门查看新闻内容

**管理端功能**:
- 📝 内容管理新增"新闻"Tab - 创建、编辑、删除新闻
- 📌 通用置顶操作 - 所有内容支持一键置顶/取消置顶

**数据库变更**:
- 新增 `daily_news` 表（每日新闻）
- Paper/Video/GithubRepo/HuggingFaceModel/Job 表新增 `isPinned`、`pinnedAt` 字段

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/news` | GET | 新闻列表（用户端） |
| `/api/news/pinned` | GET | 置顶新闻列表 |
| `/api/news/:id` | GET | 新闻详情 |
| `/api/admin/content/news` | GET/POST | 新闻列表/创建 |
| `/api/admin/content/news/:id` | PUT/DELETE | 更新/删除新闻 |
| `/api/admin/content/news/:id/pin` | PUT | 切换新闻置顶 |
| `/api/admin/content/:type/:id/pin` | PUT | 通用置顶操作 |

**涉及文件**:

后端：
- `backend/prisma/schema.user.prisma` - 新增 DailyNews 模型，现有表添加置顶字段
- `backend/src/services/daily-news.service.ts` - 新闻服务
- `backend/src/services/pin.service.ts` - 通用置顶服务
- `backend/src/controllers/daily-news.controller.ts` - 新闻控制器
- `backend/src/controllers/admin.controller.ts` - 管理端新闻处理
- `backend/src/routes/daily-news.routes.ts` - 用户端路由
- `backend/src/routes/admin.routes.ts` - 管理端路由
- `backend/src/services/discovery.service.ts` - 发现模块支持新闻和置顶

前端：
- `frontend/src/lib/api/types.ts` - DailyNews 类型定义
- `frontend/src/lib/api/daily-news.ts` - 新闻 API 客户端
- `frontend/src/app/news/page.tsx` - 新闻列表页
- `frontend/src/app/news/[id]/page.tsx` - 新闻详情页
- `frontend/src/components/PinnedItems.tsx` - 置顶内容组件
- `frontend/src/components/DiscoveryModule.tsx` - 发现模块增强
- `frontend/src/app/admin/content/page.tsx` - 管理端新闻管理

**使用说明**:
1. 管理端发布新闻：访问 `/admin/content` → 点击"新闻"Tab → 点击"新增"
2. 置顶新闻：在新闻列表中点击"置顶"按钮
3. 用户端查看：首页发现模块 → "新闻"标签 或 置顶区

**备注**:
- 新闻内容支持 Markdown 格式
- 置顶内容按置顶时间倒序排列
- 新闻详情页自动增加浏览量

---

### v3.4.4 (2026-02-24)

**类型**: 数据导入 + 功能增强

**新增功能**:
- ✨ HuggingFace 资源导入脚本，支持从 Markdown 文档批量导入模型和数据集
- ✨ 新增 `npm run import:huggingface-resources` 命令

**数据导入**:
- 📊 从 `HuggingFace_具身智能资源大全.md` 导入 **473** 个资源
- 📊 模型：152 个
- 📊 数据集：341 个（含 276 个 ALOHA 数据集）

**分类分布**:

| 分类 | 数量 |
|------|------|
| ALOHA 数据集 | 276 |
| 其他机器人模型 | 72 |
| LeRobot 数据集 | 34 |
| 视觉基础模型 | 21 |
| VLA 模型 | 17 |
| 核心数据集 | 19 |
| 分割模型 | 10 |
| 操作数据集 | 12 |
| 其他分类 | 32 |

**涉及文件**:
- `backend/src/scripts/import-huggingface-resources.ts` - 新增资源导入脚本
- `backend/package.json` - 新增 `import:huggingface-resources` 命令

**使用方法**:
```bash
cd backend && npm run import:huggingface-resources
```

**备注**:
- 脚本支持增量导入，已存在的资源会自动跳过
- 资源包含 fullName、描述、分类、类型（模型/数据集）等信息
- 可随时重新运行脚本更新数据

---

### v3.4.3 (2026-02-24)

**类型**: 配置变更

**变更说明**:
- 🔄 邮箱SMTP配置主备切换：飞书邮箱改为主用，QQ邮箱改为备用
- 🔧 优化 `email.service.ts`，所有SMTP配置从环境变量读取，不再硬编码
- 📝 更新相关文档和发版记录

**邮箱配置变更**:

| 配置 | 变更前 | 变更后 |
|------|--------|--------|
| 主用邮箱 | QQ邮箱 (smtp.qq.com:465) | 飞书邮箱 (smtp.feishu.cn:587) |
| 备用邮箱 | 飞书邮箱 | QQ邮箱 |

**代码优化**:
- 移除硬编码的SMTP配置
- 统一使用环境变量：`SMTP_SERVER`、`SMTP_PORT`、`EMAIL_USER`、`EMAIL_PASSWORD`
- 自动根据端口判断加密方式（465端口使用SSL，其他端口使用STARTTLS）

**涉及文件**:
- `backend/src/services/email.service.ts` - 重构SMTP配置读取逻辑
- `backend/.env` - 更新环境变量配置
- `docs/03-开发/开发者操作手册.md` - 更新邮箱配置说明

**切换方式**:
修改 `.env` 文件中的环境变量即可切换邮箱，无需修改代码。

---

### v3.4.2 (2026-02-24)

**类型**: 文档更新

**优化改进**:
- 📝 更新开发者操作手册，新增邮箱验证码配置章节
- 📝 记录两套邮箱SMTP配置
- 📝 更新后端环境变量配置文件

**涉及文件**:
- `docs/03-开发/开发者操作手册.md` - 新增4.5邮箱验证码配置章节
- `backend/.env` - 添加邮箱SMTP环境变量

---

### v3.4.1 (2026-02-24)

**类型**: 功能优化 + Bug修复

**问题描述**:
1. 用户完善资料后被提升到 L3，但积分只有 20，等级与积分不匹配
2. 等级体系的积分间隔过大（L3→L4 需要 1000 积分，L4→L5 需要 3500 积分）

**Bug修复**:
- 🐛 修复完善资料升级到 L3 但积分只有 20 的问题
  - 问题原因：完善资料时直接设置 `level = 3`，但没有同步增加积分
  - 解决方案：填写组织名称后奖励 300 积分，等级由积分自动计算
  - 新增积分记录，记录奖励原因
  - 只有首次填写组织名称才奖励积分，避免重复奖励

**优化改进**:
- 🚀 等级积分间隔优化，每个等级间隔不超过 500 积分
- 🔄 统一前后端等级计算逻辑，确保一致性
- 🎨 更新完善资料弹窗提示文案

**等级配置调整**:

| 等级 | 名称 | 原积分范围 | 新积分范围 | 间隔 |
|------|------|-----------|-----------|------|
| L1 | 观察者 | 0-99 | 0-99 | - |
| L2 | 探索者 | 100-499 | 100-299 | **200** |
| L3 | 贡献者 | 500-1499 | 300-599 | **300** |
| L4 | 学者 | 1500-4999 | 600-999 | **400** |
| L5 | 实践者 | 5000-9999 | 1000-1499 | **500** |
| L6 | 导师 | 10000-19999 | 1500-1999 | **500** |
| L7 | 引领者 | 20000-49999 | 2000-2999 | **500** |
| L8 | 大师 | 50000+ | 3000+ | **500** |

**涉及文件**:
- `frontend/src/lib/utils/levelUtils.ts` - 等级配置和计算函数
- `frontend/src/components/HomeSidebar.tsx` - 使用正确的等级进度计算
- `frontend/src/components/ProfileCompleteModal.tsx` - 更新提示文案
- `backend/src/services/user.service.ts` - 等级计算函数
- `backend/src/services/points.service.ts` - 等级计算函数 + 成就积分阈值
- `backend/src/controllers/user.controller.ts` - 完善资料奖励积分逻辑

**关键改进**:
```
修复前: 完善资料 → 直接设置 level = 3 → 积分仍为 20 → 等级积分不匹配

修复后: 完善资料 → 奖励 300 积分 → 积分变为 320 → 自动计算等级为 L3
```

**备注**:
- 等级现在完全由积分决定，不再有手动设置等级的情况
- 前后端等级计算逻辑完全一致
- 用户升级更有成就感，每个等级间隔合理

---

### v3.4.1 (2026-02-24)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复用户端新建订阅返回400错误的问题
  - 问题原因：前端发送的 `keywords`/`tags`/`authors` 是字符串格式，后端期望数组格式
  - 解决方案：前端改为直接发送数组格式，后端验证通过
- 🐛 修复 QuickActions 组件使用错误API的问题
  - 问题原因：QuickActions 用于订阅特定内容（如某个模型），应使用 `contentSubscriptionApi`
  - 解决方案：将 `subscriptionApi` 替换为 `contentSubscriptionApi`

**优化改进**:
- 🎨 新增 `CreateSubscriptionParams` 和 `UpdateSubscriptionParams` 类型定义
- 🎨 导出 `contentSubscriptionApi` 到 API 统一导出文件

**涉及文件**:
- `frontend/src/lib/api/subscription.ts` - 新增类型定义
- `frontend/src/lib/api/content-subscription.ts` - 内容订阅API
- `frontend/src/lib/api/index.ts` - 导出 contentSubscriptionApi
- `frontend/src/app/subscriptions/page.tsx` - 修复数据发送格式
- `frontend/src/components/QuickActions.tsx` - 修复API使用

**数据流修复**:
```
修复前: 前端发送 keywords: "embodied AI,robotics" (字符串)
        → 后端验证 Array.isArray(keywords) 失败 → 400错误

修复后: 前端发送 keywords: ["embodied AI", "robotics"] (数组)
        → 后端验证通过 → 订阅创建成功
```

---

### v3.4.0 (2026-02-24)

**类型**: 功能优化

**新增功能**:
- ✨ 定时任务全面优化，支持全量同步
- ✨ 新增定时任务配置文档（`docs/03-开发/定时任务配置文档.md`）

**优化改进**:
- 🚀 arXiv论文同步：遍历所有8个分类，每分类最多100篇，不限制总数量
- 🚀 论文关键词同步：每关键词最多100篇，不限制总数量
- 🚀 Bilibili关键词同步：每关键词最多100条，不限制总数量
- 🚀 Semantic Scholar同步：每次最多100篇，不限制总数量，依次补充
- 🚀 Bilibili视频同步：最高100条
- 🚀 全量数据同步：每任务最高100个

**稳定性措施**:
- 🔒 分类之间间隔3秒，避免触发API限流
- 🔒 错误后等待5秒再继续
- 🔒 每个任务独立执行，失败不影响其他任务
- 🔒 详细的日志记录，便于问题排查

**涉及文件**:
- `backend/src/services/sync/cron.ts` - 定时任务配置优化
- `docs/03-开发/定时任务配置文档.md` - 新增配置文档

**定时任务配置汇总**:

| 任务 | 时间 | 同步规则 | 数量限制 |
|------|------|----------|----------|
| arXiv论文同步 | 每6小时 | 全量，所有8个分类 | 每分类最多100篇 |
| 论文关键词同步 | 每6小时 | 最近30天，所有关键词 | 每关键词最多100篇 |
| Bilibili关键词同步 | 每6小时 | 最近30天，所有关键词 | 每关键词最多100条 |
| Semantic Scholar同步 | 每12小时 | 补充同步，不限数量 | 每次最多100篇 |
| GitHub项目同步 | 每8小时 | embodied intelligence | 最多100个 |
| Bilibili视频同步 | 每12小时 | UP主视频 | 最高100条 |
| HuggingFace模型同步 | 每12小时 | robotics | 最多100个 |
| 全量数据同步 | 每天凌晨2点 | 所有数据源 | 每任务最高100个 |
| 逐际动力岗位 | 每天凌晨3点 | - | - |

**备注**:
- 移除了HuggingFace论文同步（HuggingFace主要是模型和数据集）
- 移除了YouTube视频同步（未配置API Key）

---

### v3.3.0 (2026-02-23)

**类型**: 功能优化 + Bug修复

**新增功能**:
- ✨ B站UP主删除时自动级联删除关联视频
- ✨ B站API降级策略：用户信息API失败时自动从视频列表获取UP主名称
- ✨ 数据库清理脚本：支持删除所有视频和非中国厂商UP主

**优化改进**:
- 🚀 用户端视频页面筛选逻辑统一为「中国厂商」标签
- 🎨 Cookie管理界面增加详细的获取步骤说明
- 📝 更新注释和文档保持一致性

**Bug修复**:
- 🐛 修复删除UP主后视频数据成为孤儿数据的问题
- 🐛 修复用户端和管理端标签筛选不一致的问题

**涉及文件**:
- `backend/src/controllers/bilibili-uploader.controller.ts` - 删除逻辑优化
- `backend/src/services/bilibili-uploader.service.ts` - API降级策略
- `backend/src/services/bilibili/types.ts` - 类型定义补充
- `backend/src/scripts/cleanup-uploaders.ts` - 新增清理脚本
- `frontend/src/app/videos/page.tsx` - 筛选逻辑修正
- `frontend/src/app/videos/page.module.css` - 注释更新
- `frontend/src/app/admin/cookies/page.tsx` - 使用说明优化

**备注**:
- B站API无需申请官方接口，只需从浏览器复制Cookie即可
- Cookie有效期通常1-3个月，建议定期更新

---

### v3.2.4 (2026-02-23)

**类型**: 安全更新 + Bug修复

**安全更新**:
- 🔒 自定义页面模块XSS安全防护
  - 新增 `sanitizeHtml` 工具函数，过滤危险HTML标签和属性
  - 阻止 `<script>`, `<style>`, `on*` 事件属性等危险内容
  - 过滤 `javascript:`, `vbscript:`, `data:`, `file:` 等危险协议
  - 采用白名单机制，只允许安全的HTML标签和属性

**Bug修复**:
- 🐛 修复自定义页面模块后端输入验证缺失问题
  - 添加slug格式验证（小写字母、数字、连字符）
  - 添加标题长度限制（最大200字符）
  - 添加内容长度限制（最大100000字符）
  - 添加排序范围验证（0-9999）
- 🐛 修复自定义页面模块错误处理不完善问题
  - 添加slug重复检测和友好提示
  - 添加记录不存在检测
  - 添加参数有效性验证
  - 改进API错误响应状态码（400/404/500）
- 🐛 修复前端API错误提示不友好问题
  - API返回详细错误信息
  - 页面显示友好的错误提示
- 🐛 修复用户端页面文案错误
  - 将"资讯"修正为"页面"

**优化改进**:
- 🎨 管理端自定义页面表单添加更多验证规则
- 🎨 添加提交状态loading，防止重复提交
- 🎨 预览功能使用XSS过滤后的安全内容

**涉及文件**:
- `backend/src/services/custom-page.service.ts` - 输入验证和错误处理
- `backend/src/routes/custom-page.routes.ts` - 错误响应优化
- `frontend/src/lib/utils/sanitize.ts` - 新增XSS防护工具
- `frontend/src/lib/api/custom-page.ts` - 错误处理优化
- `frontend/src/app/admin/pages/page.tsx` - 表单验证和XSS防护
- `frontend/src/app/pages/page.tsx` - 文案修正
- `frontend/src/app/pages/[slug]/page.tsx` - XSS防护和错误状态

**备注**:
- 自定义页面模块现已具备完整的安全防护和错误处理机制
- 管理员可以安全地创建包含HTML内容的自定义页面

---

### v3.2.3 (2026-02-23)

**类型**: UI优化 + Bug修复

**优化改进**:
- 🎨 市集管理页面 UI 重构，统一为浅色金融科技风格
  - 统计卡片添加图标和渐变背景，与用户管理页面风格统一
  - 表格样式优化：作者列添加头像，数据列使用图标展示
  - 时间显示优化：使用 dayjs 格式化为相对时间
  - 添加刷新按钮，优化页面顶部布局结构
  - 响应式断点支持（1400px / 1100px / 768px）

**Bug修复**:
- 🐛 修复市集管理页面统计数据 API 响应格式问题
  - 问题原因：`getCommunityStats` 函数返回类型使用可选属性，导致数据可能为 undefined
  - 解决方案：确保所有字段都有默认值 0，正确处理 API 响应数据

**涉及文件**:
- `frontend/src/app/admin/community/page.tsx` - 页面组件重构
- `frontend/src/app/admin/community/page.module.css` - 样式重构为浅色金融科技风格
- `frontend/src/lib/api/admin.ts` - API 响应处理修复

**备注**:
- 市集管理页面现在与用户管理页面保持一致的设计风格
- 浅色背景 + 白色卡片 + 蓝色主题色

---

### v3.2.2 (2026-02-23)

**类型**: 功能优化 + Bug修复

**新增功能**:
- ✨ B站UP主删除时自动级联删除关联视频
- ✨ B站API降级策略：用户信息API失败时自动从视频列表获取UP主名称
- ✨ 数据库清理脚本：支持删除所有视频和非中国厂商UP主

**优化改进**:
- 🚀 用户端视频页面筛选逻辑统一为「中国厂商」标签
- 🎨 Cookie管理界面增加详细的获取步骤说明
- 📝 更新注释和文档保持一致性

**Bug修复**:
- 🐛 修复删除UP主后视频数据成为孤儿数据的问题
- 🐛 修复用户端和管理端标签筛选不一致的问题

**涉及文件**:
- `backend/src/controllers/bilibili-uploader.controller.ts` - 删除逻辑优化
- `backend/src/services/bilibili-uploader.service.ts` - API降级策略
- `backend/src/services/bilibili/types.ts` - 类型定义补充
- `backend/src/scripts/cleanup-uploaders.ts` - 新增清理脚本
- `frontend/src/app/videos/page.tsx` - 筛选逻辑修正
- `frontend/src/app/videos/page.module.css` - 注释更新
- `frontend/src/app/admin/cookies/page.tsx` - 使用说明优化

**备注**:
- B站API无需申请官方接口，只需从浏览器复制Cookie即可
- Cookie有效期通常1-3个月，建议定期更新

---

### v3.2.1 (2026-02-23)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复开发模式下速率限制导致 HuggingFace 页面 429 错误的问题
  - 问题原因：React StrictMode 双重渲染 + 后端速率限制在开发模式下仍然生效
  - 解决方案：开发模式下跳过全局速率限制中间件
  - 影响文件：`backend/src/middleware/rate-limiter.middleware.ts`

**备注**:
- 生产环境速率限制配置（60秒/100请求）足够支撑 500人/天 的访问量
- 前端已有 5 分钟内存缓存，无需额外优化

---

### v3.2.0 (2026-02-23)

**类型**: 功能优化

**新增功能**:
- ✨ 优化首页性能，实现虚拟滚动
- ✨ 添加搜索防抖和历史记录
- ✨ 实现移动端基础适配
- ✨ PDF预览功能优化
- ✨ 相关内容推荐算法

**优化改进**:
- 🚀 首屏加载时间优化至2s以内
- 🚀 图片懒加载和压缩优化
- 🚀 代码分割和缓存策略优化
- 🎨 移动端响应式布局优化

**Bug修复**:
- 🐛 修复登录状态不保持问题
- 🐛 修复收藏页强制跳转登录问题
- 🐛 修复订阅页面初始化时序问题

---

### v3.1.0 (2026-02-17)

**类型**: 功能增强

**新增功能**:
- ✨ 用户收藏功能完善
- ✨ 关键词订阅功能
- ✨ 社区帖子发布和评论
- ✨ 用户个人中心

**优化改进**:
- 🚀 API响应速度优化
- 🎨 用户界面优化
- 📝 文档完善和规范化

**Bug修复**:
- 🐛 修复Token过期处理逻辑
- 🐛 修复跨域请求问题
- 🐛 修复数据库连接池问题

---

### v3.0.0 (2026-02-10)

**类型**: 重大版本更新

**新增功能**:
- ✨ 全新的前端架构（Next.js 14 App Router）
- ✨ 用户端完整功能（论文、视频、仓库、模型、职位）
- ✨ 管理端完整功能（内容管理、数据同步、统计分析）
- ✨ 多数据源聚合（ArXiv、GitHub、HuggingFace、Bilibili）
- ✨ 实时数据同步队列

**架构变更**:
- 🔄 前端从Pages Router迁移到App Router
- 🔄 后端API规范化（RESTful设计）
- 🔄 数据库双库设计（用户库+管理库）

**技术栈**:
- 前端: Next.js 14 + React 18 + TypeScript + Ant Design 5
- 后端: Express 4 + TypeScript + Prisma 5
- 数据库: SQLite(开发) / PostgreSQL(生产)
- 缓存: Redis 7

---

### v2.0.0 (2026-01-15)

**类型**: 功能重构

**新增功能**:
- ✨ 论文聚合和展示
- ✨ 视频内容聚合
- ✨ GitHub仓库聚合
- ✨ 基础搜索功能

**架构变更**:
- 🔄 前后端分离架构
- 🔄 RESTful API设计

---

### v1.0.0 (2025-12-01)

**类型**: 初始版本

**新增功能**:
- ✨ 项目初始化
- ✨ 基础框架搭建
- ✨ 数据库设计
- ✨ 基础API实现

---

## 版本命名规范

### 版本号格式

```
主版本号.次版本号.修订号

示例: 3.2.0
- 主版本号(3): 重大架构变更或不兼容更新
- 次版本号(2): 新增功能，向后兼容
- 修订号(0): Bug修复和小改进
```

### 更新类型标识

| 标识 | 说明 |
|------|------|
| ✨ | 新增功能 |
| 🚀 | 性能优化 |
| 🎨 | 界面优化 |
| 🐛 | Bug修复 |
| 🔄 | 架构变更 |
| 📝 | 文档更新 |
| 🔒 | 安全更新 |
| ⚠️ | 废弃功能 |

---

## 发布流程

### 1. 开发阶段

```bash
# 创建开发分支
git checkout -b feature/xxx

# 开发完成后合并到develop
git checkout develop
git merge feature/xxx
```

### 2. 测试阶段

```bash
# 部署到测试环境
npm run deploy:staging

# 执行测试
npm run test:e2e
```

### 3. 发布阶段

```bash
# 合并到main分支
git checkout main
git merge develop

# 打标签
git tag -a v3.2.0 -m "Release v3.2.0"

# 推送
git push origin main --tags

# 部署到生产环境
npm run deploy:production
```

### 4. 发布后

- 更新发版记录
- 通知相关人员
- 监控线上状态

---

## 下一步计划

### v3.3.0 (计划中)

**计划功能**:
- [ ] WebSocket实时通知
- [ ] 高级搜索功能增强
- [ ] 用户行为分析
- [ ] 推荐算法优化
- [ ] 移动端PWA支持

### v4.0.0 (规划中)

**计划功能**:
- [ ] 微服务架构重构
- [ ] GraphQL API
- [ ] 多语言支持
- [ ] 企业版功能

---

## 回滚指南

### 快速回滚

```bash
# 查看历史版本
git tag

# 回滚到指定版本
git checkout v3.1.0

# 重新部署
npm run deploy:production
```

### 数据库回滚

```bash
# 恢复数据库备份
gunzip -c /opt/backups/db_v3.1.0.sql.gz | psql -U embodied_pulse embodied_pulse
```

---

**文档版本**: v2.9
**创建日期**: 2026-02-23
**最后更新**: 2026-02-24
**维护人**: 开发团队

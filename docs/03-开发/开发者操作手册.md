# Embodied Pulse 开发者操作手册

**版本**：v2.0  
**更新日期**：2026-02-17  
**适用角色**：开发人员

---

## 目录

1. [项目概述](#1-项目概述)
2. [快速启动](#2-快速启动)
3. [服务地址与端口](#3-服务地址与端口)
4. [账号与凭证](#4-账号与凭证)
5. [环境变量配置](#5-环境变量配置)
6. [常用命令](#6-常用命令)
7. [开发规范](#7-开发规范)
8. [用户端页面功能](#8-用户端页面功能)
9. [管理端页面功能](#9-管理端页面功能)
10. [API 路由清单](#10-api-路由清单)
11. [常见问题](#11-常见问题)

---

## 1. 项目概述

**项目名称**：Embodied Pulse（具身智能脉搏）  
**项目类型**：全栈 Web 应用  
**技术栈**：

| 层级 | 技术 | 版本 |
|------|------|------|
| 前端框架 | Next.js | 14.2.x |
| 前端语言 | TypeScript | 5.x |
| UI组件库 | Ant Design | 5.12.x |
| 状态管理 | Zustand | 4.5.x |
| 数据获取 | React Query | 5.28.x |
| 后端框架 | Express | 4.18.x |
| 后端语言 | TypeScript | 5.x |
| ORM | Prisma | 5.9.x |
| 数据库(开发) | SQLite | 3.44.x |
| 数据库(生产) | PostgreSQL | 15.x |
| 缓存 | Redis | 7.x |
| 任务队列 | Bull | 4.12.x |

**项目结构**：
```
Embodied Pulse/
├── frontend/          # Next.js 前端应用
│   ├── src/
│   │   ├── app/       # 页面路由 (App Router)
│   │   ├── components/# React 组件
│   │   ├── lib/       # 工具库和 API 客户端
│   │   ├── store/     # Zustand 状态管理
│   │   └── hooks/     # 自定义 Hooks
│   └── public/        # 静态资源
├── backend/           # Express 后端应用
│   ├── src/
│   │   ├── routes/    # API 路由 (57个路由模块)
│   │   ├── services/  # 业务逻辑
│   │   ├── middleware/# 中间件
│   │   └── prisma/   # 数据库模型
│   ├── prisma/       # 数据库 Schema
│   │   ├── schema.user.prisma   # 用户数据库模型
│   │   ├── schema.admin.prisma  # 管理数据库模型
│   │   ├── dev-user.db          # 用户数据库文件
│   │   └── dev-admin.db         # 管理数据库文件
│   └── .env          # 环境变量配置
└── docs/             # 项目文档
```

---

## 2. 快速启动

### 2.1 环境要求

| 软件 | 版本要求 | 说明 |
|------|----------|------|
| Node.js | ≥ 18.0.0 | 建议使用 fnm 或 nvm 管理 |
| npm | ≥ 9.0.0 | 随 Node.js 安装 |
| Redis | ≥ 6.0 | 可选，用于缓存和队列 |

### 2.2 启动命令

**前置条件**：
1. 安装 Node.js（建议使用 fnm 或 nvm）
2. 克隆项目到本地

**启动步骤**：

```bash
# 1. 进入项目目录
cd "/Users/dong/Downloads/WaleHouse/01-Finance/打工-LimX（202503-至今）/Embodied Pulse"

# 2. 启动后端（终端1）
cd backend
npm install          # 首次安装依赖
npm run dev          # 启动后端服务 (端口 3001)

# 3. 启动前端（终端2）
cd frontend
npm install          # 首次安装依赖
npm run dev          # 启动前端服务 (端口 3000)
```

**首次启动**：
```bash
# 后端首次启动会自动创建 SQLite 数据库
# 前端首次启动会编译所有页面
```

---

## 3. 服务地址与端口

### 3.1 开发环境

| 服务 | 地址 | 端口 | 说明 |
|------|------|------|------|
| 前端开发服务器 | http://localhost:3000 | 3000 | Next.js 应用 |
| 后端 API | http://localhost:3001 | 3001 | Express API |
| 后端 API 路径 | http://localhost:3001/api/v1 | - | API 根路径 |
| Redis | redis://localhost:6379 | 6379 | 缓存服务 |
| Prisma Studio | http://localhost:5555 | 5555 | 数据库管理界面 |

### 3.2 CORS 配置

允许的跨域来源：
- `http://localhost:3000`
- `http://127.0.0.1:3000`

---

## 4. 账号与凭证

### 4.1 测试账号

**用户端账号**：
| 账号类型 | 用户名 | 邮箱 | 密码 | 说明 |
|----------|--------|------|------|------|
| 测试用户 | testuser | test@example.com | password123 | 测试账号 |

**管理端账号**：
| 账号类型 | 用户名 | 邮箱 | 密码 | 说明 |
|----------|--------|------|------|------|
| 超级管理员 | limx | limx-admin@embodiedpulse.com | limx123456 | 超级管理员 (level: 10) |

### 4.2 JWT 密钥

**开发环境**（来自 backend/.env）：
```
JWT_SECRET=dev-jwt-secret-embodied-pulse-2026-secure-key
JWT_REFRESH_SECRET=dev-refresh-secret-embodied-pulse-2026-secure-key
JWT_EXPIRES_IN=7d
REFRESH_TOKEN_EXPIRES_IN=30d
```

**Token 有效期**：
| Token 类型 | 有效期 | 用途 |
|------------|--------|------|
| Access Token | 7 天 | API 调用 |
| Refresh Token | 30 天 | 刷新 Token |

**注意**：生产环境必须使用强密钥！

### 4.3 数据库

**SQLite 数据库文件**：
| 数据库 | 路径 | 说明 |
|--------|------|------|
| 用户数据库 | `backend/prisma/dev-user.db` | 用户、内容、社区数据 |
| 管理数据库 | `backend/prisma/dev-admin.db` | 管理员、配置数据 |

**数据库连接字符串**：
```
USER_DATABASE_URL="file:./prisma/dev-user.db"
ADMIN_DATABASE_URL="file:./prisma/dev-admin.db"
```

### 4.4 Redis 配置

```
REDIS_URL=redis://localhost:6379
```

### 4.5 邮箱验证码配置

项目支持多邮箱 SMTP 配置，用于发送验证码、密码重置等邮件。

#### 配置一：飞书邮箱（主用）

| 配置项 | 值 |
|--------|-----|
| SMTP服务器 | smtp.feishu.cn |
| 端口 | 587 |
| 加密方式 | STARTTLS (secure: false) |
| 用户名 | gradmotion@limxdynamics.com |
| 密码 | FBmLigwJ6CSuiW3U |

**环境变量**：
```
SMTP_SERVER=smtp.feishu.cn
SMTP_PORT=587
EMAIL_USER=gradmotion@limxdynamics.com
EMAIL_PASSWORD=FBmLigwJ6CSuiW3U
```

#### 配置二：QQ邮箱（备用）

| 配置项 | 值 |
|--------|-----|
| SMTP服务器 | smtp.qq.com |
| 端口 | 465 |
| 加密方式 | SSL (secure: true) |
| 用户名 | 404777086@qq.com |
| 授权码 | njyrjpkjmorbbgei |

**环境变量**：
```
SMTP_SERVER=smtp.qq.com
SMTP_PORT=465
EMAIL_USER=404777086@qq.com
EMAIL_PASSWORD=njyrjpkjmorbbgei
```

#### 切换邮箱配置

当前默认使用飞书邮箱配置，代码位于 `backend/src/services/email.service.ts`：

```typescript
const SMTP_HOST = process.env.SMTP_SERVER || 'smtp.feishu.cn';
const SMTP_PORT = parseInt(process.env.SMTP_PORT || '587', 10);
const SMTP_USER = process.env.EMAIL_USER || 'gradmotion@limxdynamics.com';
const SMTP_PASS = process.env.EMAIL_PASSWORD || 'FBmLigwJ6CSuiW3U';

const transporter = nodemailer.createTransport({
  host: SMTP_HOST,
  port: SMTP_PORT,
  secure: SMTP_PORT === 465,
  auth: {
    user: SMTP_USER,
    pass: SMTP_PASS,
  },
});
```

**切换邮箱**：修改 `.env` 文件中的环境变量即可，无需修改代码。

---

## 5. 环境变量配置

### 5.1 后端环境变量 (backend/.env)

```env
# Server
NODE_ENV=development
PORT=3001

# Database - User
USER_DATABASE_URL="file:./prisma/dev-user.db"

# Database - Admin  
ADMIN_DATABASE_URL="file:./prisma/dev-admin.db"

# JWT
JWT_SECRET=dev-jwt-secret-embodied-pulse-2026-secure-key
JWT_REFRESH_SECRET=dev-refresh-secret-embodied-pulse-2026-secure-key
JWT_EXPIRES_IN=7d
REFRESH_TOKEN_EXPIRES_IN=30d

# CORS
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# Redis (optional for dev)
REDIS_URL=redis://localhost:6379

# Rate Limit
RATE_LIMIT_MAX=1000
RATE_LIMIT_WINDOW_MS=60000

# Log Level
LOG_LEVEL=debug

# Base URL
BASE_URL=http://localhost:3001
```

### 5.2 前端环境变量

前端默认使用代码中的配置，无需 .env 文件：

```typescript
// 默认配置 (src/lib/api/config.ts)
const envConfig = {
  development: {
    baseUrl: 'http://localhost:3001',
    timeout: 30000,
    retries: 1,
    debug: true,
  },
  staging: {
    baseUrl: 'http://api.staging.embodiedpulse.com',
    timeout: 30000,
    retries: 2,
    debug: false,
  },
  production: {
    baseUrl: 'https://api.embodiedpulse.com',
    timeout: 30000,
    retries: 3,
    debug: false,
  },
};
```

**可选环境变量**：
```
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_API_TIMEOUT=30000
NEXT_PUBLIC_API_RETRIES=1
NEXT_PUBLIC_API_DEBUG=true
NEXT_PUBLIC_WS_URL=ws://localhost:3001
NEXT_PUBLIC_BASE_URL=https://embodiedpulse.com
```

---

## 6. 常用命令

### 6.1 前端命令

```bash
cd frontend

# 开发模式（热重载）
npm run dev

# 生产构建
npm run build

# 生产模式运行
npm start

# 代码检查
npm run lint

# 类型检查
npm run type-check

# 代码格式化
npm run format

# 测试
npm test
npm run test:watch
npm run test:coverage

# 清理缓存
rm -rf .next
npm run dev
```

### 6.2 后端命令

```bash
cd backend

# 开发模式（热重载）
npm run dev

# 生产构建
npm run build

# 生产模式运行
npm start

# 代码检查
npm run lint

# 类型检查
npm run type-check

# 数据库操作
npx prisma studio          # 打开 Prisma Studio
npx prisma db push         # 同步数据库 schema
npm run db:generate        # 生成 Prisma Client
npm run db:generate:user   # 生成用户数据库 Client
npm run db:generate:admin  # 生成管理数据库 Client
npm run db:seed            # 初始化种子数据
npm run db:studio          # 打开 Prisma Studio

# 数据同步
npm run sync               # 同步所有数据
npm run sync:embodied-ai   # 同步具身智能相关数据
npm run sync:jobs          # 同步职位数据
npm run fetch:papers       # 从 ArXiv 获取论文

# 测试
npm test
npm run test:watch
npm run test:coverage
```

### 6.3 常用快捷操作

```bash
# 重启前端（清理缓存）
cd frontend && rm -rf .next && npm run dev

# 重启后端
cd backend && npm run dev

# 查看数据库
cd backend && npx prisma studio

# 初始化数据库
cd backend && npx prisma db push && npm run db:seed
```

---

## 7. 开发规范

### 7.1 代码规范

- 使用 TypeScript 编写所有代码
- 使用 ESLint 进行代码检查
- 使用 Prettier 进行代码格式化
- 遵循项目已有的代码风格

### 7.2 Git 提交规范

```
feat: 新功能
fix: 修复 bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建/工具相关
```

### 7.3 分支管理

```
main      # 主分支
develop   # 开发分支
feature/* # 功能分支
hotfix/*  # 热修复分支
```

---

## 8. 用户端页面功能

### 8.1 公开页面（无需登录）

| 路径 | 页面名称 | 功能说明 |
|------|----------|----------|
| `/` | 首页 | 信息流展示、推荐模块、公告、Banner |
| `/papers` | 论文列表 | 浏览、搜索、筛选论文 |
| `/papers/[id]` | 论文详情 | 查看论文完整信息、PDF链接 |
| `/videos` | 视频列表 | 浏览、搜索、筛选视频 |
| `/videos/[id]` | 视频详情 | 视频播放、评论、相关推荐 |
| `/repos` | 仓库列表 | 浏览、搜索、筛选GitHub项目 |
| `/repos/[id]` | 仓库详情 | 仓库信息、README、统计 |
| `/huggingface` | 模型列表 | 浏览、搜索、筛选HuggingFace模型 |
| `/huggingface/[id]` | 模型详情 | 模型信息、下载、使用说明 |
| `/jobs` | 职位列表 | 浏览、搜索、筛选招聘职位 |
| `/jobs/[id]` | 职位详情 | 职位详情、申请链接 |
| `/community` | 社区首页 | 浏览帖子、话题讨论 |
| `/community/[id]` | 帖子详情 | 帖子内容、评论互动 |
| `/search` | 搜索结果 | 全局搜索 |
| `/ranking` | 排行榜 | 热门内容排行 |
| `/pages` | 页面列表 | 自定义页面列表 |
| `/pages/[slug]` | 自定义页面 | 管理员创建的静态页面 |
| `/user/[id]` | 用户主页 | 查看其他用户公开资料 |

### 8.2 认证页面

| 路径 | 页面名称 | 功能说明 |
|------|----------|----------|
| `/login` | 登录 | 邮箱密码登录 |
| `/register` | 注册 | 邮箱验证码注册 |
| `/forgot-password` | 忘记密码 | 密码找回 |
| `/reset-password` | 重置密码 | 密码重置 |

### 8.3 用户功能页面（需要登录）

| 路径 | 页面名称 | 功能说明 |
|------|----------|----------|
| `/profile` | 个人中心 | 用户资料管理 |
| `/settings` | 设置 | 用户设置 |
| `/favorites` | 收藏 | 收藏列表 |
| `/subscriptions` | 订阅列表 | 订阅管理 |
| `/subscriptions-new` | 新建订阅 | 创建订阅 |
| `/subscriptions/[id]` | 订阅详情 | 订阅详情页 |
| `/my-community` | 我的社区 | 我的帖子管理 |

---

## 9. 管理端页面功能

| 路径 | 页面名称 | 功能说明 |
|------|----------|----------|
| `/admin` | 管理首页 | 数据概览 |
| `/admin/login` | 管理员登录 | 管理员登录页 |
| `/admin/users` | 用户管理 | 用户列表管理 |
| `/admin/admins` | 管理员管理 | 管理员列表 |
| `/admin/content` | 内容管理 | 内容管理首页 |
| `/admin/content/papers` | 论文管理 | 论文内容管理 |
| `/admin/content/videos` | 视频管理 | 视频内容管理 |
| `/admin/content/repos` | 仓库管理 | 仓库内容管理 |
| `/admin/content/jobs` | 职位管理 | 职位内容管理 |
| `/admin/content/huggingface` | 模型管理 | HF模型管理 |
| `/admin/community` | 社区管理 | 社区内容管理 |
| `/admin/community-config` | 社区配置 | 社区功能配置 |
| `/admin/pages` | 页面管理 | 自定义页面管理 |
| `/admin/banners` | Banner管理 | 首页Banner管理 |
| `/admin/announcements` | 公告管理 | 系统公告管理 |
| `/admin/home-modules` | 首页模块 | 首页模块配置 |
| `/admin/sync` | 数据同步 | 同步任务管理 |
| `/admin/sync-queue` | 同步队列 | 队列任务管理 |
| `/admin/scheduler` | 定时任务 | 定时任务配置 |
| `/admin/data-sources` | 数据源 | 数据源配置 |
| `/admin/bilibili-uploaders` | B站UP主 | UP主订阅管理 |
| `/admin/bilibili-search-keywords` | B站关键词 | B站搜索关键词 |
| `/admin/paper-search-keywords` | 论文关键词 | 论文搜索关键词 |
| `/admin/cookies` | Cookie管理 | B站Cookie管理 |
| `/admin/subscriptions` | 订阅管理 | 用户订阅查看 |
| `/admin/stats` | 统计分析 | 数据统计 |

---

## 10. API 路由清单

后端共有 **57个路由模块**，主要分类如下：

### 10.1 认证相关 (3个)
- `auth.routes.ts` - 登录、注册、Token刷新
- `password-reset.routes.ts` - 密码重置
- `email-verification.routes.ts` - 邮箱验证

### 10.2 内容相关 (8个)
- `paper.routes.ts` - 论文
- `video.routes.ts` - 视频
- `repo.routes.ts` - GitHub仓库
- `huggingface.routes.ts` - HuggingFace模型
- `job.routes.ts` - 职位
- `feed.routes.ts` - 信息流
- `discovery.routes.ts` - 发现
- `ranking.routes.ts` - 排行榜

### 10.3 用户相关 (4个)
- `user.routes.ts` - 用户资料
- `public-user.routes.ts` - 公开用户信息
- `favorite.routes.ts` - 收藏
- `notification.routes.ts` - 通知

### 10.4 社区相关 (4个)
- `community.routes.ts` - 社区
- `post.routes.ts` - 帖子
- `comment.routes.ts` - 评论
- `community-config.routes.ts` - 社区配置

### 10.5 订阅相关 (4个)
- `subscription.routes.ts` - 关键词订阅
- `content-subscription.routes.ts` - 内容订阅
- `huggingface-subscription.routes.ts` - HF订阅
- `subscription-update.routes.ts` - 订阅更新

### 10.6 管理相关 (10个)
- `admin.routes.ts` - 管理端入口
- `sync.routes.ts` - 数据同步
- `sync-admin.routes.ts` - 同步管理
- `sync-queue.routes.ts` - 同步队列
- `scheduler.routes.ts` - 定时任务
- `data-source.routes.ts` - 数据源
- `cache.routes.ts` - 缓存管理
- `db-pool.routes.ts` - 数据库连接池
- `queue.routes.ts` - 队列管理
- `metrics.routes.ts` - 指标监控

### 10.7 配置相关 (8个)
- `banner.routes.ts` - Banner
- `announcement.routes.ts` - 公告
- `home-module.routes.ts` - 首页模块
- `custom-page.routes.ts` - 自定义页面
- `bilibili-uploader.routes.ts` - B站UP主
- `bilibili-search-keyword.routes.ts` - B站关键词
- `paper-search-keyword.routes.ts` - 论文关键词
- `cookie.routes.ts` - Cookie

### 10.8 其他 (14个)
- `search.routes.ts` - 搜索
- `stats.routes.ts` - 统计
- `upload.routes.ts` - 文件上传
- `image-proxy.routes.ts` - 图片代理
- `github-repo-info.routes.ts` - GitHub仓库信息
- `github-repo-public.routes.ts` - 公开仓库
- `huggingface-api.routes.ts` - HF API
- `huggingface-author-subscription.routes.ts` - HF作者订阅
- `job-sync.routes.ts` - 职位同步
- `task.routes.ts` - 任务
- `robots.routes.ts` - robots.txt
- `seo.routes.ts` - SEO
- `analytics.routes.ts` - 分析
- `admin-huggingface.routes.ts` - 管理端HF

---

## 11. 常见问题

### 11.1 前端启动失败

**问题**：前端启动报错或页面空白

**解决方案**：
```bash
# 清理缓存重新启动
cd frontend
rm -rf .next
npm run dev
```

### 11.2 后端数据库错误

**问题**：数据库连接失败或表不存在

**解决方案**：
```bash
# 重新生成数据库
cd backend
npx prisma db push
npm run db:generate
```

### 11.3 登录状态丢失

**问题**：刷新页面后登录状态丢失

**解决方案**：
- 检查 localStorage 中是否有 `auth-storage` 键
- 检查 authStore 的 persist 配置
- 确保后端 JWT 配置正确

### 11.4 API 请求跨域

**问题**：前端请求后端 API 跨域错误

**解决方案**：
- 确保后端 CORS 配置包含前端地址
- 检查 `CORS_ORIGINS` 环境变量
- 前端使用正确的 API 地址

### 11.5 端口被占用

**问题**：启动时端口被占用

**解决方案**：
```bash
# 查找占用端口的进程
lsof -i :3000
lsof -i :3001

# 终止进程
kill -9 <PID>
```

---

## 附录

### A. 项目路径

```
项目根目录: /Users/dong/Downloads/WaleHouse/01-Finance/打工-LimX（202503-至今）/Embodied Pulse
前端目录: /Users/dong/Downloads/WaleHouse/01-Finance/打工-LimX（202503-至今）/Embodied Pulse/frontend
后端目录: /Users/dong/Downloads/WaleHouse/01-Finance/打工-LimX（202503-至今）/Embodied Pulse/backend
文档目录: /Users/dong/Downloads/WaleHouse/01-Finance/打工-LimX（202503-至今）/Embodied Pulse/docs
```

### B. 相关文档

| 文档 | 路径 | 说明 |
|------|------|------|
| 产品需求文档 | `docs/01-需求/产品需求文档PRD.md` | 产品功能需求 |
| 技术规格文档 | `docs/02-设计/技术规格文档SPEC.md` | 技术架构设计 |
| API接口文档 | `docs/02-设计/API接口文档.md` | API接口说明 |
| 系统架构文档 | `docs/02-设计/系统架构文档.md` | 系统架构设计 |

---

**文档维护**：本文档应随项目演进持续更新。

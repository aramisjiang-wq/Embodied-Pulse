# 用户端数据库初始化

用户端登录依赖**用户端数据库**（与管理端数据库完全独立）。若登录提示「登录失败，请稍后重试」且后端日志有数据库相关报错，请按以下步骤初始化用户库。

## 1. 配置环境变量

在 `backend` 目录下确保 `.env` 中有用户库连接（若没有则添加）：

```bash
# 用户端数据库（SQLite）。开发默认 file:./prisma/dev-user.db，相对 backend 目录
USER_DATABASE_URL="file:./prisma/dev-user.db"
```

**上线部署**：必须在服务器/容器环境中配置 `USER_DATABASE_URL`（如绝对路径或远程 DB URL），不要依赖默认相对路径。

## 2. 初始化用户库表结构

在 **backend 目录**下执行（相对路径以当前目录为 backend）：

```bash
cd backend

# 按 schema 直接推送到库（推荐）
npm run db:push:user

# 或使用迁移
npm run db:migrate:user
```

执行成功后会在 `backend/prisma/dev-user.db` 创建/更新用户表。

## 3. 启动与登录

开发时请在 **backend 目录**下启动，使默认相对路径生效：

```bash
cd backend
npm run dev
```

再访问 http://localhost:3000/login 登录（若未注册请先注册）。

## 常见错误

| 现象 | 可能原因 | 处理 |
|------|----------|------|
| `Environment variable not found: USER_DATABASE_URL` | 未设置用户库连接 | 在 `backend/.env` 中添加 `USER_DATABASE_URL="file:./prisma/dev-user.db"` |
| `no such table: User` | 未执行过 db:push / migrate | 在 backend 目录执行 `npm run db:push:user` |
| 开发时找不到库文件 | 未在 backend 目录启动 | 使用 `cd backend` 后再 `npm run dev` |
| 仍提示「登录失败，请稍后重试」 | 见后端 `[Login] Authentication failed` 的 detail | 根据 detail 排查（路径、权限等） |

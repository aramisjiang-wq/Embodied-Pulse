# 域名清单文档

**文档版本**: v1.1
**创建日期**: 2026-02-28
**适用范围**: embodied.gradmotion.com 域名环境
**维护人**: AI助手团队

---

## 一、域名清单汇总

### 1.1 主域名信息

| 属性 | 值 |
|------|-----|
| 主域名 | embodied.gradmotion.com |
| 注册商 | - |
| DNS服务商 | - |
| SSL证书 | 需申请 |

### 1.2 生产环境域名

| 序号 | 应用模块 | 子域名 | 完整域名 | DNS记录类型 | 用途说明 | 端口 | 备注 |
|------|----------|--------|----------|-------------|----------|------|------|
| 1 | 用户端 | www | www.embodied.gradmotion.com | CNAME | 用户端主网站 | 80/443 | 主入口 |
| 2 | API服务 | api | api.embodied.gradmotion.com | CNAME | 后端API接口服务 | 3001 | 需配置HTTPS |
| 3 | 管理后台 | admin | admin.embodied.gradmotion.com | CNAME | 内部管理系统 | 3000 | 需IP白名单限制 |
| 4 | 静态资源 | static | static.embodied.gradmotion.com | CNAME | 图片、CSS、JS等静态资源 | 80 | CDN配置 |
| 5 | 文件存储 | files | files.embodied.gradmotion.com | CNAME | 用户上传文件访问 | - | 需配置跨域策略 |

### 1.2 测试环境域名

| 序号 | 应用模块 | 子域名 | 完整域名 | DNS记录类型 | 用途说明 | 端口 | 备注 |
|------|----------|--------|----------|-------------|----------|------|------|
| 1 | 测试网站 | test | test.embodied.gradmotion.com | CNAME | 上线前功能测试 | 80/443 | 仅内部访问 |

---

## 二、服务器端口映射

### 2.1 后端服务 (API)

| 服务名 | 容器名 | 内部端口 | 映射端口 | 协议 | 说明 |
|--------|--------|----------|----------|------|------|
| Backend API | embodied-pulse-backend | 3001 | 3001 | HTTP | 后端API服务 |
| Bull Board | embodied-pulse-bull-board | 3000 | 3001 | HTTP | 任务队列管理 |

### 2.2 数据库服务

| 服务名 | 容器名 | 内部端口 | 映射端口 | 协议 | 说明 |
|--------|--------|----------|----------|------|------|
| PostgreSQL (用户数据库) | embodied-pulse-postgres-user | 5432 | 5432 | TCP | 用户端数据库 |
| PostgreSQL (管理数据库) | embodied-pulse-postgres-admin | 5432 | 5433 | TCP | 管理端数据库 |
| Redis | embodied-pulse-redis | 6379 | 6379 | TCP | 缓存/队列 |

### 2.3 监控服务

| 服务名 | 容器名 | 内部端口 | 映射端口 | 协议 | 说明 |
|--------|--------|----------|----------|------|------|
| Prometheus | embodied-pulse-prometheus | 9090 | 9090 | HTTP | 指标监控 |
| Grafana | embodied-pulse-grafana | 3000 | 3001 | HTTP | 可视化面板 |
| Alertmanager | embodied-pulse-alertmanager | 9093 | 9093 | HTTP | 告警管理 |
| pgAdmin | embodied-pulse-pgadmin | 80 | 5050 | HTTP | 数据库管理 |

---

## 三、数据库连接信息

### 3.1 用户端数据库 (PostgreSQL)

| 配置项 | 值 | 说明 |
|--------|-----|------|
| 数据库类型 | PostgreSQL 15 | Alpine轻量版 |
| 容器名称 | embodied-pulse-postgres-user | - |
| 端口 | 5432 | 外部可访问 |
| 数据库名 | embodied_pulse_user | - |
| 用户名 | embodied_user | - |
| 密码 | (需配置环境变量) | 部署时设置 |
| 连接字符串 | postgresql://embodied_user:${password}@localhost:5432/embodied_pulse_user | 本地连接 |
| 连接字符串 | postgresql://embodied_user:${password}@postgres-user:5432/embodied_pulse_user | 容器内连接 |

### 3.2 管理端数据库 (PostgreSQL)

| 配置项 | 值 | 说明 |
|--------|-----|------|
| 数据库类型 | PostgreSQL 15 | Alpine轻量版 |
| 容器名称 | embodied-pulse-postgres-admin | - |
| 端口 | 5433 | 外部可访问 |
| 数据库名 | embodied_pulse_admin | - |
| 用户名 | embodied_admin | - |
| 密码 | (需配置环境变量) | 部署时设置 |
| 连接字符串 | postgresql://embodied_admin:${password}@localhost:5433/embodied_pulse_admin | 本地连接 |
| 连接字符串 | postgresql://embodied_admin:${password}@postgres-admin:5432/embodied_pulse_admin | 容器内连接 |

### 3.3 Redis 缓存

| 配置项 | 值 | 说明 |
|--------|-----|------|
| Redis版本 | 7 | Alpine轻量版 |
| 容器名称 | embodied-pulse-redis | - |
| 端口 | 6379 | 外部可访问 |
| 密码 | (可选) | 部署时配置 |
| 连接字符串 | redis://localhost:6379 | 本地连接 |
| 连接字符串 | redis://redis:6379 | 容器内连接 |

---

## 四、DNS 配置指南

### 4.1 A记录配置

```
记录类型: A
主机记录: @
记录值: <服务器IP地址>
TTL: 600

记录类型: A
主机记录: www
记录值: <服务器IP地址>
TTL: 600

记录类型: A
主机记录: api
记录值: <服务器IP地址>
TTL: 600

记录类型: A
主机记录: admin
记录值: <服务器IP地址>
TTL: 600

记录类型: A
主机记录: static
记录值: <CDN或服务器IP地址>
TTL: 600

记录类型: A
主机记录: files
记录值: <服务器IP地址>
TTL: 600

记录类型: A
主机记录: test
记录值: <测试服务器IP地址>
TTL: 600
```

### 4.2 CNAME记录配置 (推荐)

```
记录类型: CNAME
主机记录: www
记录值: your-vercel-project.vercel.app
TTL: 600

记录类型: CNAME
主机记录: api
记录值: your-server-ip 或负载均衡地址
TTL: 600
```

---

## 五、SSL/HTTPS 配置

### 5.1 推荐方案

| 方案 | 工具 | 适用场景 | 难度 |
|------|------|----------|------|
| Let's Encrypt + Certbot | 自动 | 单服务器 | ⭐ |
| Cloudflare SSL | 自动 | 使用Cloudflare DNS | ⭐ |
| ACM (AWS Certificate Manager) | 自动 | AWS云服务器 | ⭐⭐ |

### 5.2 Certbot 配置命令

```bash
# 安装 Certbot
sudo apt update
sudo apt install certbot python3-certbot-nginx

# 获取证书 (Nginx)
sudo certbot --nginx -d www.embodied.gradmotion.com -d api.embodied.gradmotion.com -d admin.embodied.gradmotion.com

# 获取证书 (独立)
sudo certbot certonly --standalone -d www.embodied.gradmotion.com -d api.embodied.gradmotion.com -d admin.embodied.gradmotion.com

# 自动续期
sudo certbot renew --dry-run
```

---

## 六、安全配置建议

### 6.1 防火墙规则

```bash
# 允许 SSH (限制IP)
sudo ufw allow from <允许的IP> to any port 22 proto tcp

# 允许 HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# 允许特定端口
sudo ufw allow 3000:3100/tcp

# 禁止外部访问数据库
sudo ufw allow from <服务器IP> to any port 5432
sudo ufw allow from <服务器IP> to any port 5433
sudo ufw allow from <服务器IP> to any port 6379
```

### 6.2 管理后台 IP 白名单

建议通过 Nginx 配置 IP 白名单：

```nginx
location /admin {
    allow <管理员IP>;
    deny all;
    # 其他代理配置...
}
```

---

## 七、环境变量模板

### 7.1 后端环境变量 (.env.production)

```bash
# =================================
# 应用配置
# =================================
NODE_ENV=production
PORT=3001
APP_URL=https://www.embodied.gradmotion.com

# =================================
# 用户端数据库
# =================================
DATABASE_URL=postgresql://embodied_user:${password}@localhost:5432/embodied_pulse_user

# =================================
# 管理端数据库
# =================================
ADMIN_DATABASE_URL=postgresql://embodied_admin:${password}@localhost:5433/embodied_pulse_admin

# =================================
# Redis 配置
# =================================
REDIS_URL=redis://localhost:6379

# =================================
# 认证配置
# =================================
JWT_SECRET=<生成强随机密钥>
JWT_EXPIRES_IN=7d

# =================================
# 前端 API 地址
# =================================
NEXT_PUBLIC_API_URL=https://api.embodied.gradmotion.com

# =================================
# CORS 配置
# =================================
CORS_ORIGIN=https://www.embodied.gradmotion.com,https://admin.embodied.gradmotion.com
```

### 7.2 前端环境变量

```bash
# 生产环境
NEXT_PUBLIC_API_URL=https://api.embodied.gradmotion.com
NEXT_PUBLIC_API_TIMEOUT=30000
NEXT_PUBLIC_API_RETRIES=1
NEXT_PUBLIC_API_DEBUG=false
```

---

## 八、部署检查清单

### 8.1 上线前检查

- [ ] 服务器硬件配置确认（CPU、内存、磁盘空间）
- [ ] 操作系统版本与依赖组件安装
- [ ] 网络环境配置（防火墙规则、端口开放）
- [ ] 数据库服务器配置与连接测试
- [ ] SSL证书配置与HTTPS测试

### 8.2 DNS 生效检查

```bash
# 检查 DNS 解析
nslookup www.embodied.gradmotion.com
nslookup api.embodied.gradmotion.com
nslookup admin.embodied.gradmotion.com

# 检查 SSL 证书
curl -vI https://www.embodied.gradmotion.com
curl -vI https://api.embodied.gradmotion.com
```

### 8.3 服务健康检查

```bash
# 后端 API
curl -f https://api.embodied.gradmotion.com/api/v1/feed || echo "API health check failed"

# 数据库连接
psql -h localhost -p 5432 -U embodied_user -d embodied_pulse_user -c "SELECT 1;"

# Redis 连接
redis-cli -h localhost -p 6379 ping
```

---

## 九、相关文档链接

| 文档 | 路径 |
|------|------|
| 部署文档 | `/docs/05-部署/部署文档.md` |
| 运维手册 | `/docs/05-部署/运维手册.md` |
| 技术规格 | `/docs/02-设计/技术规格文档SPEC.md` |

---

**文档版本**: v1.1
**创建日期**: 2026-02-28
**最后更新**: 2026-02-28
**维护人**: AI助手团队

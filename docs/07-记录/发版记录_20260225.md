# Embodied Pulse 发版记录

**文档版本**: v3.16
**创建日期**: 2026-02-23
**最后更新**: 2026-02-28

---

## 版本历史

### v3.16.0 (2026-02-28)

**类型**: 功能更新

**功能更新**:
- ✨ 新闻编辑器更换为 React Quill
  - 原编辑器 WangEditor 存在高度限制问题和模块加载问题
  - 更换为 react-quill-new 编辑器，功能更稳定
  - 新编辑器功能：
    - 文本格式（粗体、斜体、下划线、删除线）
    - 标题（1-6级）
    - 字体颜色、背景色
    - 列表（有序、无序）
    - 对齐方式
    - 链接、图片插入
    - 代码块、引用
  - 样式适配：工具栏使用 antd 蓝色主题，与页面风格一致

**涉及文件**:

前端：
- `frontend/src/components/RichTextEditor.tsx` - 全新 React Quill 编辑器组件
- `frontend/package.json` - 添加 react-quill-new 依赖

**验证结果**:
- ✅ 编辑新闻功能正常工作
- ✅ 所有格式化功能正常
- ✅ 图片上传功能正常
- ✅ 保存提交功能正常
- ✅ 无控制台错误

---

### v3.15.0 (2026-02-28)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复编辑新闻时 "Element type is invalid" 错误
  - 问题：点击编辑新闻按钮后报错 "Received a promise that resolves to: [object Module]. Lazy element type must resolve to a class or function"
  - 原因：使用 dynamic() 返回 Promise 解析为 Module 对象，而不是组件函数
  - 解决方案：重构 RichTextEditor 组件，在组件内部使用 useState 来管理编辑器加载状态

- 📊 新闻浏览量说明
  - 问题：用户反馈浏览量数据不准确
  - 分析结果：数据库中的 view_count 是固定值（121），浏览量只在访问新闻详情页时才会增加
  - 说明：这是设计行为 - 只有访问 /news/[id] 详情页才会增加浏览量

**涉及文件**:

前端：
- `frontend/src/components/RichTextEditor.tsx` - 重构编辑器加载逻辑

**验证结果**:
- ✅ 编辑新闻按钮不再报 "Element type is invalid" 错误
- ✅ 富文本编辑器正常加载
- ✅ 创建时间正确显示

---

### v3.14.1 (2026-02-28)

**类型**: UI优化

**优化改进**:
- 🎨 首页订阅模块标签页切换效果全面升级
  - 视觉交互效果：
    - 选中状态：使用蓝色渐变背景 `linear-gradient(135deg, #1890ff 0%, #096dd9 100%)` + 阴影效果
    - 悬停反馈：半透明蓝色背景 + 轻微上浮动画
    - 圆角设计：8px 圆角，更现代的视觉效果
  - 切换动画：
    - 内容区淡入动画 `fadeIn 0.3s ease-out`
    - 订阅卡片依次入场动画（级联延迟效果）
    - 使用 `cubic-bezier(0.4, 0, 0.2, 1)` 实现流畅过渡曲线
  - 响应式设计适配：
    - 移动端（<576px）：更小的内边距(8px)、字体(12px)
    - 平板端（<768px）：适配中尺寸屏幕
  - 用户体验优化：
    - 隐藏默认底部指示器，使用自定义渐变背景
    - 标签数量为0时自动隐藏
    - 符合UI规范：使用蓝色渐变而非紫色

**涉及文件**:

前端：
- `frontend/src/components/SubscriptionModule.tsx` - 组件集成CSS Modules类名
- `frontend/src/components/SubscriptionModule.module.css` - 新增现代化标签页样式文件

**技术实现**:
- 样式方案：CSS Modules
- 动画关键帧：`subscriptionFadeIn`、`subscriptionSlideUp`
- 延迟入场：卡片按顺序延迟50ms入场

**验证结果**:
- ✅ 前端编译无错误
- ✅ 标签页切换动画流畅
- ✅ 响应式适配正常
- ✅ 符合项目UI设计规范

---

### v3.14.0 (2026-02-28)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复推送通知设置保存500错误
  - 问题：用户在设置页面保存推送通知配置时返回 500 Internal Server Error
  - 原因：数据库 users 表缺少通知设置相关字段（email_notification、push_notification、weekly_digest、language、push_subscription）
  - 解决方案：
    1. 使用 ALTER TABLE 为 users 表添加缺失的字段
    2. 重新生成 Prisma Client 以识别新字段

- 🐛 修复 Prisma Client 缓存问题
  - 问题：Prisma Client 缓存导致新增字段无法被识别
  - 解决方案：清理 node_modules/.prisma/client-user 缓存并重新生成

**涉及文件**:

后端：
- `backend/prisma/dev-user.db` - 添加通知设置字段
- `backend/src/controllers/user.controller.ts` - 实现 updateSettings 控制器

**数据库变更**:
- 为 users 表添加 email_notification、push_notification、weekly_digest、language、push_subscription 字段

**验证结果**:
- ✅ PUT /api/v1/user/settings API 正常返回
- ✅ 设置保存成功，返回正确的数据
- ✅ 用户可以正常开启/关闭推送通知

---

### v3.13.0 (2026-02-28)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复管理端新闻页面富文本编辑器无法加载问题
  - 问题：编辑或新增新闻时富文本编辑器持续显示加载状态，无法正常使用
  - 原因：使用 import() 动态加载在 Next.js 客户端存在时序问题
  - 解决方案：改用 Next.js 的 dynamic 导入方式，并禁用 SSR

- 🐛 修复管理端新闻创建时间显示为 "-" 问题
  - 问题：新闻列表中创建时间显示为 "-"，无法正确显示日期
  - 原因：数据库中 createdAt 存储为字符串时间戳（如 "1772108114553"），new Date() 无法正确解析
  - 解决方案：在 daily-news.service.ts 中添加字符串时间戳解析逻辑

**涉及文件**:

后端：
- `backend/src/services/daily-news.service.ts` - 添加字符串时间戳解析

前端：
- `frontend/src/components/RichTextEditor.tsx` - 使用 dynamic 导入

**验证结果**:
- ✅ 富文本编辑器正常加载
- ✅ 新闻创建时间正确显示
- ✅ 编辑和新增新闻功能正常工作

---

### v3.12.0 (2026-02-28)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复用户登录500 Internal Server Error
  - 问题：用户登录时返回 500 错误，提示"登录失败，请稍后重试"
  - 原因：数据库中用户密码哈希值损坏（bcrypt哈希不完整），导致验证时抛出异常
  - 解决方案：
    1. 使用正确密码生成新的bcrypt哈希值
    2. 更新数据库中损坏的密码哈希
    3. 清理并重新生成Prisma Client解决缓存问题

- 🐛 修复Prisma Client缓存问题
  - 问题：Prisma Client缓存导致数据库查询异常
  - 解决方案：清理node_modules/.prisma并重新生成所有三个schema的Client

**涉及文件**:

后端：
- `backend/prisma/dev-user.db` - 更新用户密码哈希

**数据库变更**:
- 为用户 404777086@qq.com 更新密码哈希（密码：jd891020）

**验证结果**:
- ✅ 用户可以正常登录
- ✅ 返回正确的用户信息（username、level、points等）
- ✅ Prisma Client正常工作

---

### v3.11.1 (2026-02-28)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复一键抓取视频功能404错误
  - 问题：点击"一键抓取视频"按钮后返回 404 Not Found
  - 原因：前端调用的API路径错误，缺少 `/v1` 前缀
  - 解决方案：修正API路径为 `/api/v1/admin/sync/videos-by-keywords`

- 🐛 修复关键词相关视频数据展示异常
  - 问题：点击"关键词相关视频"按钮后显示空白
  - 原因：后端缺少 `/:id/videos` API路由
  - 解决方案：
    1. 添加 `getVideosByKeyword()` 服务函数
    2. 添加 `getKeywordVideosHandler` 控制器
    3. 注册 `GET /:id/videos` 路由

- 🐛 修复最近同步状态显示异常
  - 问题：所有关键词的"最近同步"状态显示为"从未同步"
  - 原因：API返回数据缺少 `lastSyncedAt` 字段
  - 解决方案：在关键词列表API中添加 `lastSyncedAt` 字段

**涉及文件**:

后端：
- `backend/src/controllers/bilibili-search-keyword.controller.ts` - 添加lastSyncedAt字段和getKeywordVideosHandler
- `backend/src/services/bilibili-search-keyword.service.ts` - 添加getVideosByKeyword函数
- `backend/src/routes/bilibili-search-keyword.routes.ts` - 添加/:id/videos路由

前端：
- `frontend/src/app/admin/bilibili-search-keywords/page.tsx` - 修正API路径

**验证结果**:
- ✅ 一键抓取视频功能正常工作
- ✅ 关键词相关视频正常显示
- ✅ 最近同步状态正确显示

---

### v3.11.1 (2026-02-28) [重复版本]

**类型**: Bug修复

**Bug修复**:
- 🐛 修复用户设置页面推送通知保存404错误
  - 问题：用户访问 `/profile` 页面的"设置"标签页，保存推送通知设置时返回 404 Not Found 错误
  - 原因：后端缺少 `/user/settings` API 路由和控制器
  - 解决方案：
    1. 在 `schema.user.prisma` 中添加用户设置字段
    2. 在 `user.controller.ts` 中实现 getSettings 和 updateSettings 控制器
    3. 在 `user.routes.ts` 中注册 GET/PUT `/user/settings` 路由
    4. 同步更新数据库表结构

- 🐛 修复用户设置加载功能缺失
  - 问题：设置页面刷新后不显示已保存的设置值
  - 原因：前端未在页面加载时获取用户设置
  - 解决方案：在 profile 页面添加 loadUserSettings 函数

**涉及文件**:

后端：
- `backend/prisma/schema.user.prisma` - 添加用户设置字段
- `backend/src/controllers/user.controller.ts` - 添加 getSettings/updateSettings 控制器
- `backend/src/routes/user.routes.ts` - 注册 settings 路由

前端：
- `frontend/src/lib/api/user.ts` - 添加 UserSettings 接口和 getSettings API
- `frontend/src/app/profile/page.tsx` - 添加 loadUserSettings 函数

**数据库变更**:
- 为 users 表添加 email_notification、push_notification、weekly_digest、language、push_subscription 字段

**验证结果**:
- ✅ 后端 /user/settings API 正常工作
- ✅ 推送通知设置可以成功保存
- ✅ 页面刷新后正确加载已保存的设置

---

### v3.11.0 (2026-02-28)

**类型**: Bug修复 + 功能新增

**Bug修复**:
- 🐛 修复作者订阅功能返回400 Bad Request错误
  - 问题：用户订阅HuggingFace作者时返回400错误，提示数据库表不存在
  - 原因：数据库缺少 `user_huggingface_subscriptions` 表
  - 解决方案：
    1. 在 schema.prisma 和 schema.user.prisma 中添加 UserHuggingFaceSubscription 模型
    2. 在 User 模型中添加 huggingFaceSubscriptions 关系字段
    3. 使用SQLite命令直接创建表和相关索引
    4. 重新生成Prisma Client

- 🐛 修复HuggingFace页面无效资源链接问题
  - 问题：某些模型和数据集链接重定向到404错误页面
  - 原因：HuggingFace上的资源可能被删除或移动，但数据库中仍保留链接
  - 解决方案：实现链接验证机制

**新增功能**:
- ✨ HuggingFace链接验证服务
  - 验证单个HuggingFace链接的有效性
  - 批量验证链接（默认50个/次）
  - 自动更新数据库中的linkValid和linkCheckedAt字段
  - 7天内未验证的链接会被自动重新验证

- ✨ 管理端链接验证管理功能
  - 新增"链接验证"标签页
  - 支持批量验证链接（50个或100个）
  - 显示无效链接列表
  - 支持选择并删除无效链接
  - 显示链接验证状态和验证时间

- ✨ API端点新增
  - `POST /api/admin/huggingface/validate-links` - 批量验证链接
  - `GET /api/admin/huggingface/invalid-links` - 获取无效链接列表
  - `DELETE /api/admin/huggingface/invalid-links` - 删除无效链接

**涉及文件**:

后端：
- `backend/prisma/schema.prisma` - 添加 UserHuggingFaceSubscription 模型，添加 linkValid/linkCheckedAt 字段
- `backend/prisma/schema.user.prisma` - 添加 UserHuggingFaceSubscription 模型
- `backend/src/services/huggingface-link-validation.service.ts` - 新增链接验证服务
- `backend/src/controllers/huggingface.controller.ts` - 添加链接验证控制器
- `backend/src/routes/huggingface.routes.ts` - 添加链接验证路由

前端：
- `frontend/src/lib/api/types.ts` - 添加 linkValid/linkCheckedAt 字段
- `frontend/src/lib/api/huggingface.ts` - 添加链接验证API
- `frontend/src/app/admin/content/huggingface/page.tsx` - 添加链接验证管理标签页

**数据库变更**:
- 新增 `user_huggingface_subscriptions` 表（作者订阅）
- 为 `huggingface_models` 表添加 `link_valid` 和 `link_checked_at` 字段
- 添加相关索引优化查询性能

**验证结果**:
- ✅ 作者订阅功能正常工作
- ✅ 链接验证服务可以验证HuggingFace链接有效性
- ✅ 管理端可以查看和管理无效链接
- ✅ 可以批量删除无效链接

---

### v3.10.0 (2026-02-28)

**类型**: Bug修复 + 配置优化

**Bug修复**:
- 🐛 修复产品页面模块找不到错误 "Cannot find module './vendor-chunks/@tanstack.js'"
  - 问题：产品页面出现服务器错误，提示找不到 @tanstack 模块
  - 原因：构建缓存中存在对不存在文件的引用，且 optimizePackageImports 配置不完整
  - 解决方案：
    1. 更新 next.config.js，将 @tanstack/react-query 和 @tanstack/react-query-devtools 添加到 optimizePackageImports
    2. 清除 .next/cache 构建缓存
    3. 重新编译验证

**涉及文件**:
- `frontend/next.config.js` - 添加 @tanstack 相关包到 optimizePackageImports 配置

**验证结果**:
- ✅ 产品页面正常加载，返回 HTTP 200 状态码
- ✅ 浏览器控制台无模块找不到错误
- ✅ React Query 功能正常工作

---

### v3.9.1 (2026-02-28)

**类型**: Bug修复 + 优化

**Bug修复**:
- 🐛 修复新闻接口500内部服务器错误
  - 问题：获取新闻列表返回 500 错误
  - 原因：数据库存在 createdAt 为空字符串的记录，导致 `new Date("").toISOString()` 抛出 Invalid time value
  - 解决方案：在 `daily-news.service.ts` 添加安全的时间解析函数，处理空值和无效时间戳

- 🐛 修复富文本编辑器内容不显示问题
  - 问题：编辑新闻时富文本编辑器加载但不显示内容，无法编辑
  - 原因：编辑器初始化和 value 同步时序问题
  - 解决方案：添加 `isReady` 状态确保编辑器完全初始化后同步内容

**优化改进**:
- 🎨 修复 antd Spin 组件警告
  - 问题：浏览器控制台显示 "Spin `tip` only work in nest or fullscreen pattern" 警告
  - 解决方案：移除 `tip` 属性，使用默认加载指示器

**涉及文件**:

后端：
- `backend/src/services/daily-news.service.ts` - 添加安全的时间解析函数

前端：
- `frontend/src/components/RichTextEditor.tsx` - 重构编辑器初始化逻辑，修复 Spin 警告

**验证结果**:
- ✅ 新闻列表接口正常返回数据
- ✅ 编辑新闻时富文本编辑器正常显示内容
- ✅ 浏览器控制台无 Spin 警告

---

### v3.9.0 (2026-02-28)

**类型**: 功能新增 + Bug修复

**新增功能**:
- ✨ 招聘岗位过期剩余时间显示
  - 业务规则：发布后30天自动标记过期
  - 用户端：招聘卡片显示 "招聘中 · XX天"，鼠标悬停显示具体剩余天数
  - 管理端：状态列显示 "招聘中/已关闭" + 过期状态标签（已过期/剩XX天）
  - 计算逻辑：后端实时计算剩余天数，前端直接展示

**Bug修复**:
- 🐛 修复数据库缺少 expires_at 字段问题
  - 问题：Prisma db push 未正确同步数据库表结构
  - 解决方案：手动执行 ALTER TABLE 添加字段
  - 影响：为现有 39 条岗位数据设置过期时间

**涉及文件**:

后端：
- `backend/prisma/schema.prisma` - 添加 expiresAt 字段
- `backend/prisma/schema.user.prisma` - 添加 expiresAt 字段
- `backend/src/services/job.service.ts` - getJobs/getJobSeekingPosts 返回 remainingDays
- `backend/src/services/admin.service.ts` - getAdminJobsList 返回 remainingDays

前端：
- `frontend/src/lib/api/types.ts` - Job 接口添加 remainingDays 字段
- `frontend/src/app/jobs/page.tsx` - 卡片和列表显示剩余天数
- `frontend/src/app/admin/content/jobs/page.tsx` - 管理端显示过期状态

**数据库变更**:
- 为 jobs 表添加 expires_at 字段
- 为现有 39 条岗位数据设置过期时间（创建时间 + 30 天）

**验证结果**:
- ✅ 用户端招聘页面显示 "招聘中 · XX天"
- ✅ 管理端招聘列表显示过期状态标签
- ✅ API 正确返回 remainingDays 字段

---

### v3.8.2 (2026-02-28)

**类型**: 功能优化

**优化改进**:
- 🎨 订阅模块卡片显示优化
  - 将内联匿名函数重构为独立的模块化函数 `getSubscriptionDisplay()`
  - 订阅卡片优先显示关键词（关键词:），而不是作者（作者:）
  - 提高代码可维护性和可读性

**涉及文件**:
- `frontend/src/components/SubscriptionModule.tsx` - 添加模块化显示函数

**验证结果**:
- ✅ 首页订阅卡片正确显示关键词信息
- ✅ 代码结构更清晰，便于后续维护

---

### v3.8.1 (2026-02-28)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复管理端新闻页面创建时间显示错误
  - 问题：显示为"1772-12-20 14:55"，实际应为"2026-02-26"
  - 原因：数据库存储毫秒时间戳，前端解析错误
  - 解决方案：在后端 `daily-news.service.ts` 中将时间戳转换为 ISO 8601 格式

- 🐛 修复管理端新闻页面内容编辑器加载问题
  - 问题：编辑新闻时内容板块显示加载中，无法编辑
  - 原因：`RichTextEditorInner` 组件未同步 value 变化
  - 解决方案：添加 `useEffect` 监听 value 变化并更新编辑器内容

**涉及文件**:

后端：
- `backend/src/services/daily-news.service.ts` - 时间戳格式转换

前端：
- `frontend/src/components/RichTextEditor.tsx` - 编辑器内容同步更新

**验证结果**:
- ✅ 新闻列表创建时间显示正确
- ✅ 编辑新闻时内容编辑器正常显示
- ✅ 新增新闻时内容编辑器正常工作

---

### v3.8.0 (2026-02-28)

**类型**: 功能增强 + Bug修复 + 数据清理

**新增功能**:
- ✨ B站搜索关键词页面增强
  - 新增Cookie状态栏：显示Cookie健康状态、活跃数量、最后使用时间
  - 新增关键词统计API：从数据库实时获取准确的启用/禁用统计
  - 修复统计不准确问题：解决"115关键词，100启用"实际115全启用的显示错误
  - 新增视频抓取进度面板：显示同步进度、日志、成功/失败统计
  - 新增手动输入Cookie功能：提供详细的Cookie获取步骤说明

- ✨ Cookie管理API路径修复
  - 问题：前端API路径包含重复的 `/api` 前缀
  - 解决方案：移除 `/api/admin/bilibili-cookies` 中的多余 `/api`

**Bug修复**:
- 🐛 修复前端编译错误
  - 问题：page.tsx 第1180行语法错误 `size="middle}`
  - 解决方案：修正为 `size="middle"`

- 🐛 修复Cookie API 404错误
  - 问题：请求 URL 变成 `/api/v1/api/admin/bilibili-cookies` (重复/api)
  - 解决方案：修正 cookie.ts 中的 API 路径

**数据清理**:
- 🧹 清理测试视频数据
  - 删除数据库中 199 条 "Test Video" 测试视频
  - 保留 1591 条正式视频数据
  - 涉及表：videos

**涉及文件**:

后端：
- `backend/src/services/bilibili-search-keyword.service.ts` - 新增 getKeywordStats 函数
- `backend/src/controllers/bilibili-search-keyword.controller.ts` - 新增 getKeywordStatsHandler
- `backend/src/routes/bilibili-search-keyword.routes.ts` - 新增 /stats 路由

前端：
- `frontend/src/app/admin/bilibili-search-keywords/page.tsx` - 页面全面重构
- `frontend/src/app/admin/bilibili-search-keywords/page.module.css` - 新增样式
- `frontend/src/lib/api/bilibili-search-keyword.ts` - 新增 getStats API
- `frontend/src/lib/api/cookie.ts` - 修复API路径（移除重复/api）

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/admin/bilibili-search-keywords/stats` | GET | 获取关键词统计 |

**验证结果**:
- ✅ B站搜索关键词页面显示准确的统计数据
- ✅ Cookie状态栏正常显示
- ✅ 手动输入Cookie功能正常工作
- ✅ 视频抓取进度面板可视化正常
- ✅ 前端页面编译无错误
- ✅ 视频页面清理完成，无测试数据

---

### v3.7.0 (2026-02-28)

**类型**: 功能优化 + Bug修复

**新增功能**:
- ✨ 数据源页面任务状态实时展示
  - 在页面顶部添加任务状态显示区域
  - 显示当前任务执行状态（执行中/已完成）
  - 实时进度条显示
  - 成功/失败计数统计
  - 5秒自动轮询更新状态
  - 上次任务执行结果展示

- ✨ B站搜索关键词页面优化
  - 新增"最近同步"字段，精确到分钟显示
  - 视频数为0时显示灰色，有视频时显示绿色
  - 添加API同步重试机制（最多2次重试）
  - 60秒超时限制
  - 网络错误自动重试

- ✨ B站上传者页面API同步稳定性优化
  - 添加重试机制（最多2次）
  - 60秒超时限制
  - 网络错误和超时自动重试
  - 用户友好的加载提示

- ✨ 视频删除功能修复
  - 问题：前端调用删除API返回 VIDEO_DELETION_FAILED 错误
  - 原因：后端缺少 DELETE /videos/:videoId 路由
  - 解决方案：添加视频删除API端点和控制器

- ✨ 域名配置更新
  - 主域名从 gradmotion.com 改为 embodied.gradmotion.com
  - 更新所有子域名配置
  - 更新 CI/CD 配置文件中的域名

**涉及文件**:

后端：
- `backend/src/routes/video.routes.ts` - 添加删除API路由
- `backend/src/controllers/video.controller.ts` - 添加删除处理器
- `backend/prisma/schema.admin.prisma` - 添加 last_synced_at 字段

前端：
- `frontend/src/app/admin/data-sources/page.tsx` - 添加任务状态显示区域
- `frontend/src/lib/api/sync.ts` - 添加 getSyncStatus API
- `frontend/src/app/admin/bilibili-search-keywords/page.tsx` - 添加最近同步列和重试
- `frontend/src/app/admin/bilibili-uploaders/page.tsx` - 添加同步重试机制

配置更新：
- `docs/05-部署/域名清单文档.md` - 域名配置更新
- `.github/workflows/backend-ci.yml` - 部署环境URL更新
- `.github/workflows/frontend-ci.yml` - 部署环境URL更新
- `docker-compose.yml` - pgAdmin邮箱更新

**数据库变更**:
- 为 BilibiliSearchKeyword 表添加 last_synced_at 字段

**验证结果**:
- ✅ 数据源页面显示任务状态（需要后端API认证）
- ✅ B站搜索关键词页面显示最近同步时间
- ✅ B站上传者页面同步重试机制正常工作
- ✅ 前端页面编译无错误

---

### v3.6.0 (2026-02-24)

**类型**: 功能优化 + Bug修复

**Bug修复**:
- 🐛 修复用户积分与等级不一致问题
  - 问题原因：用户填写组织名称后直接设置 level=3，但积分未同步增加
  - 解决方案：创建修复脚本，为已填写组织名称但积分不足的用户补足300积分
  - 影响用户：2个用户数据已修复
  - 等级计算规则：L3需要300-599积分

**优化改进**:
- 🎨 置顶内容卡片 UI/UX 全面优化
  - 卡片式设计，每个置顶项独立展示
  - 支持单独展开/收起，一键查看完整内容
  - 移除滚动条，内容完整展示，提升阅读体验
  - 优化标题、描述、来源信息的排版布局

- 🎨 HuggingFace 标签按钮样式优化
  - 添加 `whiteSpace: 'nowrap'` 防止图标和文字换行
  - 添加 flex 布局确保内容居中对齐
  - 提升按钮视觉一致性

- ✨ 管理端新闻配置支持富文本编辑
  - 集成 wangeditor 富文本编辑器
  - 支持文本格式化（加粗、斜体、下划线等）
  - 支持列表、引用、代码块
  - 支持图片、链接插入
  - 新增内容预览功能

**涉及文件**:

后端：
- `backend/src/scripts/fix-user-points-level.ts` - 新增用户积分修复脚本

前端：
- `frontend/src/components/PinnedItems.tsx` - 置顶内容组件重构
- `frontend/src/components/DiscoveryModule.tsx` - HuggingFace 标签样式优化
- `frontend/src/components/RichTextEditor.tsx` - 新增富文本编辑器组件
- `frontend/src/app/admin/news/page.tsx` - 新闻管理页面集成富文本编辑器
- `frontend/src/app/admin/content/huggingface/page.tsx` - 修复 TextArea 导入问题

**验证结果**:
- ✅ 用户积分与等级数据一致性已修复
- ✅ 置顶内容卡片展示完整，无滚动条
- ✅ HuggingFace 标签按钮图标文字同行显示
- ✅ 管理端新闻配置富文本编辑器正常工作

---

### v3.5.9 (2026-02-24)

**类型**: Bug修复

**问题描述**:
- 管理后台管理员页面点击"审计日志"按钮返回 404 错误
- API 路径 `/api/v1/admin/admins/:adminId/audit-logs` 未实现

**Bug修复**:
- 🐛 修复管理员审计日志 API 缺失问题
  - 新增 `AdminAuditLog` 数据库模型
  - 新增审计日志服务 `admin-audit.service.ts`
  - 新增审计日志 API 端点 `GET /admin/admins/:adminId/audit-logs`

**新增功能**:
- ✨ 管理员审计日志系统
  - 支持记录管理员操作（登录、权限变更、用户管理等）
  - 支持按管理员 ID 查询审计日志
  - 支持分页查询

**数据库变更**:
- 新增 `admin_audit_logs` 表
  - `admin_id` - 管理员ID
  - `action` - 操作类型
  - `target` - 操作对象
  - `details` - 操作详情（JSON）
  - `ip` - IP地址
  - `created_at` - 创建时间

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/admin/admins/:adminId/audit-logs` | GET | 获取管理员审计日志 |

**涉及文件**:

后端：
- `backend/prisma/schema.prisma` - 新增 AdminAuditLog 模型
- `backend/src/services/admin-audit.service.ts` - 新增审计日志服务
- `backend/src/controllers/admin.controller.ts` - 新增审计日志控制器
- `backend/src/routes/admin.routes.ts` - 新增审计日志路由

**管理员页面功能验证**:

| 按钮 | API路由 | 状态 |
|------|---------|------|
| 搜索管理员 | `GET /admin/admins` | ✅ |
| 新增管理员 | `POST /admin/admins` | ✅ |
| 权限配置 | `PUT /admin/admins/:adminId/permissions` | ✅ |
| 编辑标签 | `POST /admin/admins/:adminId/tags` | ✅ |
| 审计日志 | `GET /admin/admins/:adminId/audit-logs` | ✅ 已修复 |

---

### v3.5.8 (2026-02-24)

**类型**: Bug修复

**问题描述**:
- 首页发现模块"全部"标签下置顶的新闻不显示
- 前端 API 类型定义缺少 `'news'` 类型，导致 TypeScript 类型不匹配

**Bug修复**:
- 🐛 修复前端 discovery API 类型定义缺少 `'news'` 类型
  - 问题原因：`discovery.ts` 中 `contentType` 类型定义缺少 `'news'`
  - 解决方案：添加 `'news'` 到 `contentType` 类型定义
  - 同时添加 `pinnedItems` 到返回类型

- 🐛 修复 DiscoveryItem 接口缺少置顶相关字段
  - 问题原因：`DiscoveryItem` 接口缺少 `contentType`、`isPinned`、`pinnedAt` 字段
  - 解决方案：补充缺失的字段定义

**涉及文件**:
- `frontend/src/lib/api/discovery.ts` - 添加 `'news'` 类型和 `pinnedItems` 返回类型
- `frontend/src/components/DiscoveryModule.tsx` - 补充 `DiscoveryItem` 接口字段

**验证结果**:
- ✅ API 返回 `pinnedItems` 数组，包含置顶新闻
- ✅ 首页发现模块"全部"和"新闻"标签正确显示置顶内容

---

### v3.5.8 (2026-02-24)

**类型**: 功能新增 + 数据补充

**功能新增**:
- ✨ HuggingFace资源页面分类数量显示
  - 侧边栏分类按钮旁边显示对应资源数量
  - 内容类型（模型/数据集）显示统计数量
  - 模型分类和数据集分类各子分类显示数量
  - 便于用户快速了解各分类资源规模

**数据补充**:
- 📊 HuggingFace资源数据大规模补充
  - 修复导入脚本标题匹配问题（支持无顿号格式如"二十一人形机器人数据集"）
  - 补充文档中缺失分类的HuggingFace资源
  - 补充多个前端定义但数据库为空的分类
  - 所有分类现在都有≥10个资源
  
- 📈 最终数据统计:
  - 总资源数: 735条
  - 模型: 217个
  - 数据集: 518个
  - 分类: 41个（全部≥10个资源）

**补充的分类资源**:
| 分类 | 数量 |
|------|------|
| simulation-datasets | 165 |
| other-robot-models | 76 |
| lerobot-datasets | 34 |
| humanoid-datasets | 31 |
| navigation-datasets | 29 |
| libero-datasets | 27 |
| aloha-datasets | 24 |
| vision-models | 21 |
| vla-models | 17 |
| manipulation-datasets | 12 |
| 其他33个分类 | 各10个 |

**修复的Bug**:
- 🐛 统计API修复
  - 问题：统计API只按task字段统计，contentType和category未统计
  - 解决方案：getTaskTypeStats函数添加contentType和category统计
  
- 🐛 前端页面初始化问题
  - 问题：loadTaskStats只在筛选条件变化时调用，页面初始不加载
  - 解决方案：分离useEffect，页面加载时自动获取统计数据

**涉及文件**:
- `backend/src/services/huggingface.service.ts` - 统计API修复
- `frontend/src/app/huggingface/page.tsx` - 数量显示 + useEffect修复
- `frontend/src/app/huggingface/page.module.css` - 分类数量样式
- `backend/src/scripts/import-huggingface-resources.ts` - 导入脚本修复
- `backend/src/scripts/supplement-huggingface-resources*.ts` - 补充导入脚本

---

### v3.5.7 (2026-02-24)

**类型**: Bug修复

**Bug修复**:
- 🐛 修复 HuggingFace 管理页面组件导入错误
  - 问题原因：缺少 `InputNumber` 和 `TextArea` 组件导入
  - 解决方案：从 antd 正确导入 `InputNumber` 和 `TextArea`

**涉及文件**:
- `frontend/src/app/admin/content/huggingface/page.tsx` - 修复组件导入

---

### v3.5.6 (2026-02-24)

**类型**: 功能新增

**新增功能**:
- ✨ GitHub项目分类补充功能：管理端可从GitHub搜索新项目并按分类添加
  - 为每个分类定义智能搜索关键词（基于资源清单文档）
  - 支持查看每个分类可补充的项目数量
  - 支持批量选择、批量添加项目
  - 自动过滤已存在的项目，避免重复添加
  - 只补充 Stars≥100 的高质量项目

**管理端功能**:
- 📦 新增"分类补充"按钮，位于项目管理页面顶部
- 📊 显示各分类可补充项目数量统计
- ✅ 支持全选/单选，批量添加选中的项目
- 🔗 可直接跳转GitHub查看项目详情

**用户端优化**:
- 🔄 GitHub项目页面默认排序改为"最近更新"，便于用户发现最新项目

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/admin/repos/suggestions/stats` | GET | 获取各分类候选项目统计 |
| `/api/admin/repos/suggestions/:category` | GET | 搜索指定分类的候选项目 |
| `/api/admin/repos/batch` | POST | 批量添加仓库 |

**涉及文件**:

后端：
- `backend/src/services/repo-category-search.service.ts` - 新增分类搜索服务
- `backend/src/controllers/admin.controller.ts` - 新增分类补充控制器
- `backend/src/routes/admin.routes.ts` - 新增API路由

前端：
- `frontend/src/app/admin/content/repos/page.tsx` - 新增分类补充弹窗

**使用说明**:
1. 登录管理后台
2. 进入"内容管理" → "GitHub项目"
3. 点击"分类补充"按钮
4. 选择要补充的分类
5. 勾选要添加的项目
6. 点击"添加选中的项目"

---

### v3.5.5 (2026-02-24)

**类型**: Bug修复

**问题描述**:
- 管理端新增首页模块失败，API 返回 401 Unauthorized "未提供Token"
- 获取模块列表也返回 401 错误

**Bug修复**:
- 🐛 修复管理端首页模块 API 认证失败问题
  - 问题原因：`client.ts` 中 `isPublicApi` 包含 `/home-modules`，导致管理端请求时不携带管理员 token
  - 解决方案：将 `/home-modules` 从 `isPublicApi` 中移除，由 `isAdminOnlyApi` 判断是否需要管理员权限

**涉及文件**:
- `frontend/src/lib/api/client.ts` - 修复 API 认证逻辑

**修复后逻辑**:
- GET /home-modules → 公开API（用户端展示活跃模块）
- GET /home-modules/all → 需要 admin_token（管理端查看）
- POST /home-modules → 需要 admin_token（新增模块）
- PUT/DELETE /home-modules/:id → 需要 admin_token（更新/删除）

**验证结果**:
- ✅ 管理端页面可以正常获取模块列表
- ✅ 管理端可以正常新增/编辑/删除模块

---

### v3.5.4 (2026-02-24)

**类型**: 功能新增

**新增功能**:
- ✨ 管理端新增独立的新闻管理页面 `/admin/news`
  - 支持新闻的创建、编辑、删除操作
  - 支持一键置顶/取消置顶
  - 支持分页浏览
  - 支持富文本（Markdown）格式内容

**UI改进**:
- 🎨 管理端侧边栏新增"新闻管理"菜单项
- 🎨 新闻管理页面与项目设计规范统一

**涉及文件**:
- `frontend/src/app/admin/news/page.tsx` - 新增新闻管理页面
- `frontend/src/app/admin/layout.tsx` - 侧边栏添加新闻管理菜单

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/admin/content/news` | GET | 新闻列表 |
| `/api/admin/content/news` | POST | 创建新闻 |
| `/api/admin/content/news/:id` | PUT | 更新新闻 |
| `/api/admin/content/news/:id` | DELETE | 删除新闻 |
| `/api/admin/content/news/:id/pin` | PUT | 切换置顶状态 |

---

### v3.5.3 (2026-02-24)

**类型**: 功能优化

**优化改进**:
- 🎨 HuggingFace 管理页面全面优化，提供完整的数据管理功能
  - 模型列表 Tab 新增：新增、编辑、删除、查看详情功能
  - 支持关键词搜索，内容类型筛选（模型/数据集/Space）、任务类型筛选、排序
  - 新增详情抽屉，展示完整模型信息
  - 新增统计卡片：模型总数、数据集数量、Spaces数量、本月新增
- 🎨 统一页面设计风格，与论文管理页面保持一致

**涉及文件**:
- `frontend/src/app/admin/content/huggingface/page.tsx` - 页面组件重构
- `frontend/src/app/admin/content/huggingface/page.module.css` - 样式文件

---

### v3.5.2 (2026-02-24)

**类型**: Bug修复

**问题描述**:
1. 页面无数据显示，API返回空数据但数据库有数据
2. Prisma Schema 与数据库表结构不一致，缺少 `is_pinned` 和 `pinned_at` 字段
3. Prisma 客户端生成失败，`Notification` 模型关系字段未正确忽略

**Bug修复**:
- 🐛 修复数据库表结构不一致问题
  - 问题原因：数据库表中缺少 `is_pinned` 和 `pinned_at` 字段
  - 解决方案：为 `papers`、`videos`、`github_repos`、`huggingface_models`、`jobs` 表添加缺失字段
  - 错误信息：`The column main.papers.is_pinned does not exist in the current database`

- 🐛 修复 Prisma Schema 关系字段未正确忽略问题
  - 问题原因：`Notification` 模型有 `@@ignore` 指令，但 `User` 模型中的 `notifications` 关系字段缺少 `@ignore` 属性
  - 解决方案：为 `notifications` 字段添加 `@ignore` 属性

**涉及文件**:
- `backend/prisma/schema.user.prisma` - 修复 User 模型 notifications 字段
- `backend/prisma/dev-user.db` - 数据库表结构修复（添加 is_pinned、pinned_at 字段）

**数据库变更**:
```sql
-- 为各表添加置顶相关字段
ALTER TABLE papers ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE papers ADD COLUMN pinned_at DATETIME;
ALTER TABLE videos ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE videos ADD COLUMN pinned_at DATETIME;
ALTER TABLE github_repos ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE github_repos ADD COLUMN pinned_at DATETIME;
ALTER TABLE huggingface_models ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE huggingface_models ADD COLUMN pinned_at DATETIME;
ALTER TABLE jobs ADD COLUMN is_pinned INTEGER DEFAULT 0;
ALTER TABLE jobs ADD COLUMN pinned_at DATETIME;
```

**验证结果**:
- ✅ API 正常返回数据
- ✅ 统计数据：papers: 1661, videos: 736, repos: 363, huggingface: 493, jobs: 95
- ✅ 发现页正常展示混合内容

**备注**:
- 此问题由 v3.5.0 版本新增置顶功能时数据库迁移未完成导致
- 建议后续使用 Prisma Migration 管理数据库变更，避免手动修改

---

### v3.5.1 (2026-02-24)

**类型**: Bug修复 + UI优化

**Bug修复**:
- 🐛 修复新闻页面 API 导入错误
  - 问题原因：`daily-news.ts` 错误导入了不存在的 `cachedClient` 对象
  - 解决方案：改为正确导入 `cachedGet` 函数和 `apiClient`
  - 影响文件：`frontend/src/lib/api/daily-news.ts`

**优化改进**:
- 🎨 新闻列表页 UI 重构，与项目设计规范统一
  - 使用 `PageContainer` 组件保持页面一致性
  - 采用与 papers 页面相同的双栏布局设计
  - 统一的卡片样式、分页组件和响应式设计
- 🎨 新闻详情页 UI 重构
  - 统一的详情页布局和样式
  - 规范化的内容渲染

**涉及文件**:
- `frontend/src/lib/api/daily-news.ts` - 修复 API 导入错误
- `frontend/src/app/news/page.tsx` - 列表页重构
- `frontend/src/app/news/page.module.css` - 新增列表页样式
- `frontend/src/app/news/[id]/page.tsx` - 详情页重构
- `frontend/src/app/news/[id]/page.module.css` - 新增详情页样式

**备注**:
- 新闻页面现在与论文、视频等其他页面保持一致的设计风格
- 浅色背景 + 白色卡片 + 蓝色主题色

---

### v3.5.0 (2026-02-24)

**类型**: 功能新增

**新增功能**:
- ✨ 每日新闻功能：管理端可发布每日新闻，支持富文本（Markdown）格式
- ✨ 通用置顶系统：所有内容类型（论文、视频、GitHub、HuggingFace、招聘、新闻）支持置顶
- ✨ 发现模块增强：新增"新闻"标签，置顶内容区展示

**用户端功能**:
- 📰 新闻列表页 `/news` - 按日期倒序展示所有新闻
- 📰 新闻详情页 `/news/[id]` - 展示完整新闻内容
- 📌 发现模块置顶区 - 展示置顶的新闻和其他内容
- 🏷️ 发现模块新增"新闻"标签 - 专门查看新闻内容

**管理端功能**:
- 📝 内容管理新增"新闻"Tab - 创建、编辑、删除新闻
- 📌 通用置顶操作 - 所有内容支持一键置顶/取消置顶

**数据库变更**:
- 新增 `daily_news` 表（每日新闻）
- Paper/Video/GithubRepo/HuggingFaceModel/Job 表新增 `isPinned`、`pinnedAt` 字段

**API端点**:

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/news` | GET | 新闻列表（用户端） |
| `/api/news/pinned` | GET | 置顶新闻列表 |
| `/api/news/:id` | GET | 新闻详情 |
| `/api/admin/content/news` | GET/POST | 新闻列表/创建 |
| `/api/admin/content/news/:id` | PUT/DELETE | 更新/删除新闻 |
| `/api/admin/content/news/:id/pin` | PUT | 切换新闻置顶 |
| `/api/admin/content/:type/:id/pin` | PUT | 通用置顶操作 |

**涉及文件**:

后端：
- `backend/prisma/schema.user.prisma` - 新增 DailyNews 模型，现有表添加置顶字段
- `backend/src/services/daily-news.service.ts` - 新闻服务
- `backend/src/services/pin.service.ts` - 通用置顶服务
- `backend/src/controllers/daily-news.controller.ts` - 新闻控制器
- `backend/src/controllers/admin.controller.ts` - 管理端新闻处理
- `backend/src/routes/daily-news.routes.ts` - 用户端路由
- `backend/src/routes/admin.routes.ts` - 管理端路由
- `backend/src/services/discovery.service.ts` - 发现模块支持新闻和置顶

前端：
- `frontend/src/lib/api/types.ts` - DailyNews 类型定义
- `frontend/src/lib/api/daily-news.ts` - 新闻 API 客户端
- `frontend/src/app/news/page.tsx` - 新闻列表页
- `frontend/src/app/news/[id]/page.tsx` - 新闻详情页
- `frontend/src/components/PinnedItems.tsx` - 置顶内容组件
- `frontend/src/components/DiscoveryModule.tsx` - 发现模块增强
- `frontend/src/app/admin/content/page.tsx` - 管理端新闻管理

**使用说明**:
1. 管理端发布新闻：访问 `/admin/content` → 点击"新闻"Tab → 点击"新增"
2. 置顶新闻：在新闻列表中点击"置顶"按钮
3. 用户端查看：首页发现模块 → "新闻"标签 或 置顶区

**备注**:
- 新闻内容支持 Markdown 格式
- 置顶内容按置顶时间倒序排列
- 新闻详情页自动增加浏览量

---

## 版本命名规范

### 版本号格式

```
主版本号.次版本号.修订号

示例: 3.2.0
- 主版本号(3): 重大架构变更或不兼容更新
- 次版本号(2): 新增功能，向后兼容
- 修订号(0): Bug修复和小改进
```

### 更新类型标识

| 标识 | 说明 |
|------|------|
| ✨ | 新增功能 |
| 🚀 | 性能优化 |
| 🎨 | 界面优化 |
| 🐛 | Bug修复 |
| 🔄 | 架构变更 |
| 📝 | 文档更新 |
| 🔒 | 安全更新 |
| ⚠️ | 废弃功能 |

---

## 发布流程

### 1. 开发阶段

```bash
# 创建开发分支
git checkout -b feature/xxx

# 开发完成后合并到develop
git checkout develop
git merge feature/xxx
```

### 2. 测试阶段

```bash
# 部署到测试环境
npm run deploy:staging

# 执行测试
npm run test:e2e
```

### 3. 发布阶段

```bash
# 合并到main分支
git checkout main
git merge develop

# 打标签
git tag -a v3.2.0 -m "Release v3.2.0"

# 推送
git push origin main --tags

# 部署到生产环境
npm run deploy:production
```

### 4. 发布后

- 更新发版记录
- 通知相关人员
- 监控线上状态

---

## 下一步计划

### v3.12.0 (计划中)

**计划功能**:
- [ ] WebSocket实时通知
- [ ] 高级搜索功能增强
- [ ] 用户行为分析
- [ ] 推荐算法优化
- [ ] 移动端PWA支持

### v4.0.0 (规划中)

**计划功能**:
- [ ] 微服务架构重构
- [ ] GraphQL API
- [ ] 多语言支持
- [ ] 企业版功能

---

## 回滚指南

### 快速回滚

```bash
# 查看历史版本
git tag

# 回滚到指定版本
git checkout v3.1.0

# 重新部署
npm run deploy:production
```

### 数据库回滚

```bash
# 恢复数据库备份
gunzip -c /opt/backups/db_v3.1.0.sql.gz | psql -U embodied_pulse embodied_pulse
```

---

**文档版本**: v3.14
**创建日期**: 2026-02-23
**最后更新**: 2026-02-28
**维护人**: 开发团队

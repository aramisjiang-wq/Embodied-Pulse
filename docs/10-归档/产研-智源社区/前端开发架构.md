# 智源社区前端开发架构

## 1. 技术栈选型

### 1.1 核心框架
- **React 18.2+**: 主前端框架，采用函数组件 + Hooks
- **TypeScript 5.0+**: 类型安全，提升开发效率
- **Next.js 14+**: React框架，支持SSR/SSG/ISR

### 1.2 UI组件库
- **Ant Design 5.0+**: 企业级UI组件库
- **Tailwind CSS 3.0+**: 原子化CSS框架
- **Framer Motion**: 动画效果库
- **React Icons**: 图标库

### 1.3 状态管理
- **Zustand 4.0+**: 轻量级全局状态管理
- **React Query 5.0+**: 服务端状态管理和数据获取
- **React Hook Form 7.0+**: 表单状态管理

### 1.4 路由
- **Next.js App Router**: 内置路由系统
- **React Router 6.0+**: 备选方案

### 1.5 HTTP客户端
- **Axios**: HTTP请求库
- **Fetch API**: 原生请求API

### 1.6 工具库
- **Lodash**: JavaScript工具库
- **Day.js**: 日期处理库
- **UUID**: 唯一标识生成
- **clsx**: 类名合并
- **tailwind-merge**: Tailwind类名合并

### 1.7 开发工具
- **Vite**: 构建工具
- **ESLint**: 代码检查
- **Prettier**: 代码格式化
- **Husky**: Git钩子
- **lint-staged**: 暂存文件检查
- **Commitlint**: 提交信息检查

### 1.8 测试工具
- **Jest**: 单元测试框架
- **React Testing Library**: React组件测试
- **Playwright**: 端到端测试
- **MSW**: API Mock

## 2. 项目结构

### 2.1 目录结构

```
baai-hub/
├── .github/                    # GitHub配置
│   ├── workflows/             # GitHub Actions工作流
│   └── ISSUE_TEMPLATE/        # Issue模板
├── public/                    # 静态资源
│   ├── images/               # 图片资源
│   ├── icons/                # 图标资源
│   └── favicon.ico           # 网站图标
├── src/                       # 源代码
│   ├── app/                  # Next.js App Router
│   │   ├── (auth)/          # 认证相关路由组
│   │   │   ├── login/       # 登录页
│   │   │   └── register/    # 注册页
│   │   ├── (main)/          # 主路由组
│   │   │   ├── page.tsx     # 首页
│   │   │   ├── category/    # 分类页
│   │   │   │   └── [id]/    # 分类详情
│   │   │   ├── article/     # 文章页
│   │   │   │   └── [id]/    # 文章详情
│   │   │   ├── search/      # 搜索页
│   │   │   ├── user/        # 用户中心
│   │   │   └── admin/       # 管理后台
│   │   ├── api/             # API路由
│   │   │   ├── auth/        # 认证API
│   │   │   ├── articles/    # 文章API
│   │   │   └── users/       # 用户API
│   │   ├── layout.tsx       # 根布局
│   │   └── globals.css      # 全局样式
│   ├── components/          # 组件
│   │   ├── common/         # 通用组件
│   │   │   ├── Button/     # 按钮组件
│   │   │   ├── Card/       # 卡片组件
│   │   │   ├── Input/      # 输入框组件
│   │   │   ├── Modal/      # 模态框组件
│   │   │   ├── Tag/        # 标签组件
│   │   │   └── Loading/    # 加载组件
│   │   ├── layout/         # 布局组件
│   │   │   ├── Header/     # 头部导航
│   │   │   ├── Footer/     # 页脚
│   │   │   ├── Sidebar/    # 侧边栏
│   │   │   └── Breadcrumb/ # 面包屑
│   │   ├── article/        # 文章组件
│   │   │   ├── ArticleCard/     # 文章卡片
│   │   │   ├── ArticleList/     # 文章列表
│   │   │   ├── ArticleDetail/   # 文章详情
│   │   │   └── ArticleMeta/     # 文章元信息
│   │   ├── category/       # 分类组件
│   │   │   ├── CategoryNav/     # 分类导航
│   │   │   ├── TagCloud/        # 标签云
│   │   │   └── CategoryFilter/  # 分类筛选
│   │   ├── search/         # 搜索组件
│   │   │   ├── SearchBox/       # 搜索框
│   │   │   ├── SearchResults/   # 搜索结果
│   │   │   └── SearchSuggestion/# 搜索建议
│   │   ├── user/           # 用户组件
│   │   │   ├── UserAvatar/      # 用户头像
│   │   │   ├── UserMenu/        # 用户菜单
│   │   │   ├── UserProfile/     # 用户资料
│   │   │   └── UserStats/       # 用户统计
│   │   └── admin/          # 管理组件
│   │       ├── AdminLayout/     # 管理布局
│   │       ├── AdminSidebar/    # 管理侧边栏
│   │       ├── ArticleEditor/   # 文章编辑器
│   │       └── DataTable/       # 数据表格
│   ├── hooks/               # 自定义Hooks
│   │   ├── useAuth.ts      # 认证Hook
│   │   ├── useArticles.ts  # 文章Hook
│   │   ├── useSearch.ts    # 搜索Hook
│   │   ├── useDebounce.ts  # 防抖Hook
│   │   ├── useInfinite.ts  # 无限滚动Hook
│   │   └── useLocalStorage.ts # 本地存储Hook
│   ├── stores/              # 状态管理
│   │   ├── authStore.ts    # 认证状态
│   │   ├── uiStore.ts      # UI状态
│   │   └── userStore.ts    # 用户状态
│   ├── services/            # API服务
│   │   ├── api.ts          # API配置
│   │   ├── auth.ts         # 认证服务
│   │   ├── articles.ts     # 文章服务
│   │   ├── categories.ts   # 分类服务
│   │   ├── search.ts       # 搜索服务
│   │   └── users.ts        # 用户服务
│   ├── types/               # TypeScript类型
│   │   ├── article.ts      # 文章类型
│   │   ├── category.ts     # 分类类型
│   │   ├── user.ts         # 用户类型
│   │   ├── api.ts          # API类型
│   │   └── common.ts       # 通用类型
│   ├── utils/               # 工具函数
│   │   ├── format.ts       # 格式化函数
│   │   ├── validation.ts   # 验证函数
│   │   ├── storage.ts      # 存储函数
│   │   ├── request.ts      # 请求封装
│   │   └── constants.ts    # 常量定义
│   ├── styles/              # 样式文件
│   │   ├── globals.css     # 全局样式
│   │   ├── variables.css   # CSS变量
│   │   └── themes.css      # 主题样式
│   ├── lib/                 # 第三方库配置
│   │   ├── axios.ts        # Axios配置
│   │   ├── query.ts        # React Query配置
│   │   └── analytics.ts    # 分析工具配置
│   └── config/              # 配置文件
│       ├── site.ts         # 站点配置
│       └── routes.ts       # 路由配置
├── tests/                   # 测试文件
│   ├── unit/               # 单元测试
│   ├── integration/        # 集成测试
│   └── e2e/                # 端到端测试
├── .eslintrc.js            # ESLint配置
├── .prettierrc.js          # Prettier配置
├── tsconfig.json           # TypeScript配置
├── tailwind.config.js      # Tailwind配置
├── next.config.js          # Next.js配置
├── package.json            # 项目依赖
└── README.md               # 项目说明
```

### 2.2 组件设计原则

#### 单一职责原则
每个组件只负责一个功能，保持组件的简洁和可维护性。

#### 组件复用性
通过props配置实现组件的灵活复用，避免重复代码。

#### 组件组合性
通过组合简单组件构建复杂组件，提高代码的可读性和可维护性。

#### 性能优化
使用React.memo、useMemo、useCallback等优化组件性能。

## 3. 核心组件实现

### 3.1 通用组件

#### Button组件
```typescript
// components/common/Button/index.tsx
import { Button as AntButton, ButtonProps as AntButtonProps } from 'antd';
import { clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export interface ButtonProps extends AntButtonProps {
  variant?: 'primary' | 'secondary' | 'text' | 'ghost';
  size?: 'small' | 'medium' | 'large';
  loading?: boolean;
}

export const Button: React.FC<ButtonProps> = ({
  variant = 'primary',
  size = 'medium',
  loading = false,
  className,
  children,
  ...props
}) => {
  const baseStyles = 'rounded-md transition-all duration-300';
  
  const variantStyles = {
    primary: 'bg-blue-500 text-white hover:bg-blue-600',
    secondary: 'bg-white text-gray-900 border border-gray-300 hover:border-blue-500',
    text: 'bg-transparent text-blue-500 hover:bg-blue-50',
    ghost: 'bg-transparent text-gray-900 hover:bg-gray-100',
  };
  
  const sizeStyles = {
    small: 'px-3 py-1.5 text-sm',
    medium: 'px-4 py-2 text-base',
    large: 'px-6 py-3 text-lg',
  };

  return (
    <AntButton
      className={twMerge(
        baseStyles,
        variantStyles[variant],
        sizeStyles[size],
        className
      )}
      loading={loading}
      {...props}
    >
      {children}
    </AntButton>
  );
};
```

#### Card组件
```typescript
// components/common/Card/index.tsx
import { clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export interface CardProps {
  children: React.ReactNode;
  className?: string;
  hoverable?: boolean;
  onClick?: () => void;
}

export const Card: React.FC<CardProps> = ({
  children,
  className,
  hoverable = false,
  onClick,
}) => {
  const baseStyles = 'bg-white rounded-lg shadow-sm p-6 transition-all duration-300';
  const hoverStyles = hoverable
    ? 'hover:shadow-md hover:-translate-y-1 cursor-pointer'
    : '';

  return (
    <div
      className={twMerge(baseStyles, hoverStyles, className)}
      onClick={onClick}
    >
      {children}
    </div>
  );
};
```

#### Input组件
```typescript
// components/common/Input/index.tsx
import { Input as AntInput, InputProps as AntInputProps } from 'antd';
import { twMerge } from 'tailwind-merge';

export interface InputProps extends AntInputProps {
  error?: string;
}

export const Input: React.FC<InputProps> = ({
  error,
  className,
  ...props
}) => {
  return (
    <div className="w-full">
      <AntInput
        className={twMerge(
          'rounded-md border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200',
          error && 'border-red-500',
          className
        )}
        {...props}
      />
      {error && (
        <p className="mt-1 text-sm text-red-500">{error}</p>
      )}
    </div>
  );
};
```

### 3.2 文章组件

#### ArticleCard组件
```typescript
// components/article/ArticleCard/index.tsx
import Link from 'next/link';
import { Card } from '@/components/common/Card';
import { Tag } from '@/components/common/Tag';
import { Article } from '@/types/article';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';

export interface ArticleCardProps {
  article: Article;
}

export const ArticleCard: React.FC<ArticleCardProps> = ({ article }) => {
  return (
    <Card hoverable>
      <Link href={`/article/${article.id}`}>
        <div className="space-y-3">
          <div className="flex items-center gap-2">
            {article.category && (
              <Tag variant="primary">{article.category.name}</Tag>
            )}
            {article.tags?.slice(0, 3).map((tag) => (
              <Tag key={tag.id} variant="secondary">
                {tag.name}
              </Tag>
            ))}
          </div>
          
          <h3 className="text-xl font-semibold text-gray-900 hover:text-blue-600 transition-colors">
            {article.title}
          </h3>
          
          <p className="text-gray-600 line-clamp-3">
            {article.summary}
          </p>
          
          <div className="flex items-center gap-4 text-sm text-gray-500">
            <span>{article.author?.name}</span>
            <span>·</span>
            <span>{formatDistanceToNow(new Date(article.createdAt), {
              addSuffix: true,
              locale: zhCN
            })}</span>
            <span>·</span>
            <span>{article.viewCount} 阅读</span>
          </div>
        </div>
      </Link>
    </Card>
  );
};
```

#### ArticleList组件
```typescript
// components/article/ArticleList/index.tsx
import { ArticleCard } from './ArticleCard';
import { Loading } from '@/components/common/Loading';
import { Empty } from '@/components/common/Empty';
import { Article } from '@/types/article';

export interface ArticleListProps {
  articles: Article[];
  loading?: boolean;
  error?: string;
  onLoadMore?: () => void;
  hasMore?: boolean;
}

export const ArticleList: React.FC<ArticleListProps> = ({
  articles,
  loading = false,
  error,
  onLoadMore,
  hasMore = false,
}) => {
  if (error) {
    return <Empty description={error} />;
  }

  if (articles.length === 0 && !loading) {
    return <Empty description="暂无文章" />;
  }

  return (
    <div className="space-y-4">
      {articles.map((article) => (
        <ArticleCard key={article.id} article={article} />
      ))}
      
      {loading && <Loading />}
      
      {hasMore && !loading && (
        <div className="text-center">
          <button
            onClick={onLoadMore}
            className="px-6 py-2 text-blue-600 hover:text-blue-700"
          >
            加载更多
          </button>
        </div>
      )}
    </div>
  );
};
```

### 3.3 自定义Hooks

#### useAuth Hook
```typescript
// hooks/useAuth.ts
import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { authService } from '@/services/auth';
import { User } from '@/types/user';

export const useAuth = () => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const router = useRouter();

  useEffect(() => {
    checkAuth();
  }, []);

  const checkAuth = async () => {
    try {
      const token = localStorage.getItem('token');
      if (token) {
        const userData = await authService.getCurrentUser();
        setUser(userData);
      }
    } catch (error) {
      console.error('Auth check failed:', error);
    } finally {
      setLoading(false);
    }
  };

  const login = async (email: string, password: string) => {
    const { user, token } = await authService.login(email, password);
    localStorage.setItem('token', token);
    setUser(user);
    return user;
  };

  const logout = async () => {
    await authService.logout();
    localStorage.removeItem('token');
    setUser(null);
    router.push('/login');
  };

  return {
    user,
    loading,
    login,
    logout,
    isAuthenticated: !!user,
  };
};
```

#### useArticles Hook
```typescript
// hooks/useArticles.ts
import { useState, useEffect } from 'react';
import { articleService } from '@/services/articles';
import { Article } from '@/types/article';

export const useArticles = (params?: {
  categoryId?: string;
  tagId?: string;
  page?: number;
  limit?: number;
}) => {
  const [articles, setArticles] = useState<Article[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [hasMore, setHasMore] = useState(true);

  const fetchArticles = async (reset = false) => {
    try {
      setLoading(true);
      setError(null);
      
      const response = await articleService.getArticles({
        ...params,
        page: reset ? 1 : params?.page || 1,
      });

      if (reset) {
        setArticles(response.data);
      } else {
        setArticles((prev) => [...prev, ...response.data]);
      }

      setHasMore(response.hasMore);
    } catch (err) {
      setError(err instanceof Error ? err.message : '加载失败');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchArticles(true);
  }, [params?.categoryId, params?.tagId]);

  const loadMore = () => {
    if (!loading && hasMore) {
      fetchArticles(false);
    }
  };

  const refresh = () => {
    fetchArticles(true);
  };

  return {
    articles,
    loading,
    error,
    hasMore,
    loadMore,
    refresh,
  };
};
```

### 3.4 状态管理

#### authStore
```typescript
// stores/authStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { User } from '@/types/user';

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  setUser: (user: User | null) => void;
  setToken: (token: string | null) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      setUser: (user) => set({ user, isAuthenticated: !!user }),
      setToken: (token) => set({ token }),
      logout: () => set({ user: null, token: null, isAuthenticated: false }),
    }),
    {
      name: 'auth-storage',
    }
  )
);
```

## 4. 性能优化策略

### 4.1 代码分割
```typescript
// 动态导入组件
const ArticleEditor = dynamic(() => import('@/components/admin/ArticleEditor'), {
  loading: () => <Loading />,
  ssr: false,
});
```

### 4.2 图片优化
```typescript
// 使用Next.js Image组件
import Image from 'next/image';

<Image
  src="/images/article.jpg"
  alt="Article cover"
  width={800}
  height={600}
  loading="lazy"
  placeholder="blur"
/>
```

### 4.3 缓存策略
```typescript
// React Query配置
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5分钟
      cacheTime: 10 * 60 * 1000, // 10分钟
      refetchOnWindowFocus: false,
    },
  },
});
```

### 4.4 虚拟滚动
```typescript
// 使用react-window处理长列表
import { FixedSizeList as List } from 'react-window';

<List
  height={600}
  itemCount={articles.length}
  itemSize={200}
  width="100%"
>
  {({ index, style }) => (
    <div style={style}>
      <ArticleCard article={articles[index]} />
    </div>
  )}
</List>
```

## 5. 开发规范

### 5.1 代码规范
- 使用TypeScript类型检查
- 遵循ESLint规则
- 使用Prettier格式化代码
- 组件命名使用PascalCase
- 函数命名使用camelCase
- 常量命名使用UPPER_SNAKE_CASE

### 5.2 Git规范
- 分支命名：feature/xxx, bugfix/xxx, hotfix/xxx
- 提交信息：feat: xxx, fix: xxx, docs: xxx
- 代码审查：所有PR需要至少一人审查
- 合并策略：使用Squash and Merge

### 5.3 注释规范
- 组件顶部添加功能说明
- 复杂逻辑添加注释说明
- API接口添加JSDoc注释
- 避免无意义的注释

## 6. 测试策略

### 6.1 单元测试
```typescript
// 测试组件
import { render, screen } from '@testing-library/react';
import { Button } from '@/components/common/Button';

describe('Button', () => {
  it('renders correctly', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('calls onClick when clicked', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    screen.getByText('Click me').click();
    expect(handleClick).toHaveBeenCalledTimes(1);
  });
});
```

### 6.2 集成测试
```typescript
// 测试页面
import { render, screen, waitFor } from '@testing-library/react';
import Home from '@/app/page';

describe('Home Page', () => {
  it('displays articles', async () => {
    render(<Home />);
    await waitFor(() => {
      expect(screen.getByText('最新资讯')).toBeInTheDocument();
    });
  });
});
```

### 6.3 E2E测试
```typescript
// Playwright测试
import { test, expect } from '@playwright/test';

test('user can login', async ({ page }) => {
  await page.goto('/login');
  await page.fill('input[name="email"]', 'test@example.com');
  await page.fill('input[name="password"]', 'password123');
  await page.click('button[type="submit"]');
  await expect(page).toHaveURL('/');
});
```

---

**文档版本**: v1.0
**创建日期**: 2026-02-05
**最后更新**: 2026-02-05
**文档状态**: 待审核

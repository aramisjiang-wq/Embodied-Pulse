# Embodied Pulse Pro 技术规格文档 (SPEC)

**产品名称**：Embodied Pulse Pro（具身智能脉搏 Pro）
**文档类型**：技术规格文档
**版本**：v1.0
**创建日期**：2026-02-25
**最后更新**：2026-02-25

---

## 目录

1. [系统架构设计](#一系统架构设计)
2. [技术栈选型](#二技术栈选型)
3. [数据库设计](#三数据库设计)
4. [API接口设计](#四api接口设计)
5. [前端架构设计](#五前端架构设计)
6. [后端架构设计](#六后端架构设计)
7. [安全设计](#七安全设计)
8. [性能设计](#八性能设计)
9. [部署架构](#九部署架构)

---

## 一、系统架构设计

### 1.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              客户端层 (Client Layer)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        用户端 (User Frontend)                        │  │
│   │   Next.js 14 + TypeScript + Ant Design 5 + React Query              │  │
│   │   ├── 首页、论文、视频、资源、新闻、招聘页面                          │  │
│   │   ├── 认证页面（登录、注册、密码找回）                                │  │
│   │   └── 个人中心页面（资料、收藏、订阅）                                │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        管理端 (Admin Frontend)                       │  │
│   │   Next.js 14 + TypeScript + Ant Design 5 + React Query              │  │
│   │   ├── 内容管理（论文、视频、资源、新闻、招聘）                        │  │
│   │   ├── 用户管理、管理员管理                                            │  │
│   │   └── 数据同步、定时任务、关键词管理                                  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              网关层 (Gateway Layer)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        Nginx 反向代理                                 │  │
│   │   ├── 静态资源服务                                                    │  │
│   │   ├── SSL终止                                                         │  │
│   │   ├── 负载均衡                                                        │  │
│   │   └── 请求路由（/api/v1/* → Backend, /* → Frontend）                 │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              服务层 (Service Layer)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    后端服务 (Backend API)                            │  │
│   │   Express + TypeScript + Prisma                                      │  │
│   │                                                                       │  │
│   │   ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐              │  │
│   │   │ 认证服务  │ │ 内容服务  │ │ 订阅服务  │ │ 同步服务  │              │  │
│   │   │  Auth    │ │ Content  │ │ Subscribe│ │  Sync    │              │  │
│   │   └──────────┘ └──────────┘ └──────────┘ └──────────┘              │  │
│   │   ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐              │  │
│   │   │ 用户服务  │ │ 搜索服务  │ │ 管理服务  │ │ 通知服务  │              │  │
│   │   │  User    │ │  Search  │ │  Admin   │ │  Notify  │              │  │
│   │   └──────────┘ └──────────┘ └──────────┘ └──────────┘              │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              数据层 (Data Layer)                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐       │
│   │   PostgreSQL    │    │     Redis       │    │   文件存储       │       │
│   │   (主数据库)     │    │  (缓存/队列)     │    │   (OSS/本地)    │       │
│   │   Prisma ORM    │    │   Bull Queue    │    │                 │       │
│   └─────────────────┘    └─────────────────┘    └─────────────────┘       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           外部服务层 (External Services)                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐            │
│   │ ArXiv   │ │ GitHub  │ │Bilibili │ │HuggingFace│ │ 招聘平台 │           │
│   │  API    │ │  API    │ │  API    │ │   API    │ │   API   │            │
│   └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 模块划分

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              模块划分                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   用户端模块                                                                  │
│   ├── auth-module        认证模块（登录、注册、密码找回）                      │
│   ├── content-module     内容模块（论文、视频、资源、新闻、招聘）              │
│   ├── search-module      搜索模块（全局搜索、筛选）                           │
│   ├── user-module        用户模块（个人资料、收藏、订阅）                      │
│   └── notify-module      通知模块（订阅通知、系统通知）                        │
│                                                                             │
│   管理端模块                                                                  │
│   ├── admin-auth-module  管理员认证模块                                      │
│   ├── admin-content      内容管理模块（CRUD）                                │
│   ├── admin-user         用户管理模块                                        │
│   ├── admin-sync         数据同步模块                                        │
│   └── admin-system       系统管理模块（关键词、定时任务）                      │
│                                                                             │
│   后端服务模块                                                                │
│   ├── auth-service       认证服务（JWT、权限验证）                            │
│   ├── content-service    内容服务（CRUD、查询）                               │
│   ├── sync-service       同步服务（数据抓取、定时任务）                        │
│   ├── search-service     搜索服务（全文搜索、筛选）                           │
│   ├── notify-service     通知服务（订阅匹配、消息推送）                        │
│   └── admin-service      管理服务（管理端API）                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、技术栈选型

### 2.1 前端技术栈

| 技术 | 版本 | 用途 | 选择理由 |
|------|------|------|----------|
| Next.js | 14.x | 前端框架 | SSR支持、SEO友好、成熟稳定 |
| TypeScript | 5.x | 类型系统 | 类型安全、开发体验好 |
| Ant Design | 5.x | UI组件库 | 组件丰富、企业级、中文友好 |
| React Query | 5.x | 数据请求 | 缓存管理、自动重试、DevTools |
| Zustand | 4.x | 状态管理 | 轻量、简洁、TypeScript友好 |
| Tailwind CSS | 3.x | 样式框架 | 原子化CSS、开发效率高 |
| Axios | 1.x | HTTP客户端 | 拦截器、请求取消、类型支持 |

### 2.2 后端技术栈

| 技术 | 版本 | 用途 | 选择理由 |
|------|------|------|----------|
| Node.js | 20.x LTS | 运行时 | 生态丰富、前后端统一 |
| Express | 4.x | Web框架 | 轻量灵活、中间件丰富 |
| TypeScript | 5.x | 类型系统 | 类型安全、代码提示 |
| Prisma | 5.x | ORM | 类型安全、迁移管理、查询构建 |
| JWT | 9.x | 身份认证 | 无状态、跨域支持 |
| bcrypt | 5.x | 密码加密 | 安全性高、行业标准 |
| Zod | 3.x | 数据验证 | 类型推导、错误信息友好 |
| Bull | 4.x | 任务队列 | Redis支持、延迟任务、重试 |

### 2.3 数据存储

| 技术 | 版本 | 用途 | 选择理由 |
|------|------|------|----------|
| PostgreSQL | 15.x | 主数据库 | 开源、功能强大、JSON支持 |
| Redis | 7.x | 缓存/队列 | 高性能、数据结构丰富 |
| SQLite | 3.x | 开发数据库 | 零配置、便于开发调试 |

### 2.4 开发工具

| 工具 | 用途 |
|------|------|
| ESLint | 代码检查 |
| Prettier | 代码格式化 |
| Vitest | 单元测试 |
| Playwright | E2E测试 |
| Docker | 容器化部署 |
| GitHub Actions | CI/CD |

---

## 三、数据库设计

### 3.1 ER图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              数据库ER图                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────┐                                                           │
│   │    User     │                                                           │
│   ├─────────────┤                                                           │
│   │ id (PK)     │──────┐                                                    │
│   │ username    │      │                                                    │
│   │ email       │      │    ┌─────────────┐    ┌─────────────┐             │
│   │ passwordHash│      │    │Subscription │    │   Favorite  │             │
│   │ avatarUrl   │      ├───▶│ userId (FK) │    │ userId (FK) │◀────────┐   │
│   │ level       │      │    │ type        │    │ contentType│         │   │
│   │ points      │      │    │ keywords    │    │ contentId  │         │   │
│   │ role        │      │    │ isActive    │    │ createdAt  │         │   │
│   │ createdAt   │      │    └─────────────┘    └─────────────┘         │   │
│   └─────────────┘      │                                           │   │
│          │             │                                           │   │
│          │             │    ┌─────────────┐                         │   │
│          │             └───▶│   Comment   │                         │   │
│          │                  │ userId (FK) │                         │   │
│          │                  │ contentType │                         │   │
│          │                  │ contentId   │◀────────────────────────┘   │
│          │                  │ content     │                             │
│          │                  └─────────────┘                             │
│          │                                                              │
│          ▼                                                              │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                        内容数据模型                               │   │
│   │                                                                  │   │
│   │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │   │
│   │  │    Paper    │ │    Video    │ │   Resource  │               │   │
│   │  ├─────────────┤ ├─────────────┤ ├─────────────┤               │   │
│   │  │ id (PK)     │ │ id (PK)     │ │ id (PK)     │               │   │
│   │  │ arxivId     │ │ bvid        │ │ type        │               │   │
│   │  │ title       │ │ title       │ │ subType     │               │   │
│   │  │ authors     │ │ description │ │ title       │               │   │
│   │  │ abstract    │ │ coverUrl    │ │ description │               │   │
│   │  │ pdfUrl      │ │ duration    │ │ tags        │               │   │
│   │  │ citationCnt │ │ playCount   │ │ stars       │               │   │
│   │  │ viewCount   │ │ uploaderId  │ └──────┬──────┘               │   │
│   │  └─────────────┘ └─────────────┘        │                      │   │
│   │                                          │ 1:N                  │   │
│   │                                          ▼                      │   │
│   │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │   │
│   │  │    News     │ │     Job     │ │ResourceSource│              │   │
│   │  ├─────────────┤ ├─────────────┤ ├─────────────┤               │   │
│   │  │ id (PK)     │ │ id (PK)     │ │ id (PK)     │               │   │
│   │  │ title       │ │ title       │ │ resourceId  │               │   │
│   │  │ summary     │ │ company     │ │ platform    │               │   │
│   │  │ content     │ │ location    │ │ platformId  │               │   │
│   │  │ source      │ │ salaryMin   │ │ url         │               │   │
│   │  │ sourceUrl   │ │ salaryMax   │ │ stars       │               │   │
│   │  │ category    │ │ applyUrl    │ └─────────────┘               │   │
│   │  └─────────────┘ └─────────────┘                               │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                  │
│   │   Admin     │    │EmailVerify  │    │PasswordReset│                  │
│   ├─────────────┤    ├─────────────┤    ├─────────────┤                  │
│   │ id (PK)     │    │ id (PK)     │    │ id (PK)     │                  │
│   │ username    │    │ email       │    │ email       │                  │
│   │ email       │    │ code        │    │ token       │                  │
│   │ passwordHash│    │ type        │    │ expiresAt   │                  │
│   │ role        │    │ expiresAt   │    │ used        │                  │
│   └─────────────┘    └─────────────┘    └─────────────┘                  │
│                                                                             │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                  │
│   │   SyncLog   │    │   Uploader  │    │   Keyword   │                  │
│   ├─────────────┤    ├─────────────┤    ├─────────────┤                  │
│   │ id (PK)     │    │ id (PK)     │    │ id (PK)     │                  │
│   │ type        │    │ mid         │    │ type        │                  │
│   │ status      │    │ name        │    │ keyword     │                  │
│   │ message     │    │ faceUrl     │    │ isActive    │                  │
│   │ createdAt   │    │ isActive    │    │ createdAt   │                  │
│   └─────────────┘    └─────────────┘    └─────────────┘                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 数据表详细设计

#### 3.2.1 用户表 (User)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| username | VARCHAR(50) | UNIQUE, NOT NULL | 用户名 |
| email | VARCHAR(255) | UNIQUE, NOT NULL | 邮箱 |
| passwordHash | VARCHAR(255) | NOT NULL | 密码哈希 |
| avatarUrl | VARCHAR(500) | | 头像URL |
| level | INTEGER | DEFAULT 1 | 用户等级 |
| points | INTEGER | DEFAULT 0 | 积分 |
| role | VARCHAR(20) | DEFAULT 'user' | 角色：user, vip |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.2 论文表 (Paper)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| arxivId | VARCHAR(50) | UNIQUE | ArXiv ID |
| title | VARCHAR(500) | NOT NULL | 标题 |
| authors | TEXT[] | | 作者列表 |
| abstract | TEXT | | 摘要 |
| pdfUrl | VARCHAR(500) | | PDF链接 |
| codeUrl | VARCHAR(500) | | 代码链接 |
| citationCount | INTEGER | DEFAULT 0 | 引用数 |
| viewCount | INTEGER | DEFAULT 0 | 浏览数 |
| publishedAt | DATE | | 发布日期 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.3 视频表 (Video)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| bvid | VARCHAR(50) | UNIQUE | B站BV号 |
| title | VARCHAR(500) | NOT NULL | 标题 |
| description | TEXT | | 简介 |
| coverUrl | VARCHAR(500) | | 封面URL |
| duration | INTEGER | | 时长(秒) |
| playCount | INTEGER | DEFAULT 0 | 播放量 |
| likeCount | INTEGER | DEFAULT 0 | 点赞数 |
| uploaderId | UUID | FK | UP主ID |
| publishedAt | TIMESTAMP | | 发布时间 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.4 资源表 (Resource)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| type | VARCHAR(20) | NOT NULL | 一级类型 |
| subType | VARCHAR(50) | NOT NULL | 二级类型 |
| title | VARCHAR(500) | NOT NULL | 标题 |
| description | TEXT | | 描述 |
| tags | TEXT[] | | 标签列表 |
| stars | INTEGER | DEFAULT 0 | Star数 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.5 资源来源表 (ResourceSource)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| resourceId | UUID | FK, NOT NULL | 资源ID |
| platform | VARCHAR(20) | NOT NULL | 平台：github, huggingface, other |
| platformId | VARCHAR(100) | | 平台ID |
| url | VARCHAR(500) | NOT NULL | 跳转链接 |
| stars | INTEGER | DEFAULT 0 | 该平台Star数 |
| lastSyncedAt | TIMESTAMP | | 最后同步时间 |

#### 3.2.6 新闻表 (News)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| title | VARCHAR(500) | NOT NULL | 标题 |
| summary | TEXT | | 摘要 |
| content | TEXT | | 内容 |
| source | VARCHAR(100) | | 来源 |
| sourceUrl | VARCHAR(500) | | 来源链接 |
| category | VARCHAR(50) | | 分类：融资、产品、政策、学术等 |
| coverUrl | VARCHAR(500) | | 封面URL |
| publishedAt | TIMESTAMP | | 发布时间 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.7 职位表 (Job)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| title | VARCHAR(200) | NOT NULL | 职位名称 |
| company | VARCHAR(200) | | 公司名称 |
| location | VARCHAR(100) | | 工作地点 |
| salaryMin | INTEGER | | 最低薪资(K) |
| salaryMax | INTEGER | | 最高薪资(K) |
| description | TEXT | | 职位描述 |
| requirements | TEXT | | 任职要求 |
| applyUrl | VARCHAR(500) | NOT NULL | 申请链接 |
| source | VARCHAR(50) | | 来源平台 |
| publishedAt | TIMESTAMP | | 发布时间 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.8 收藏表 (Favorite)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| userId | UUID | FK, NOT NULL | 用户ID |
| contentType | VARCHAR(20) | NOT NULL | 内容类型 |
| contentId | UUID | NOT NULL | 内容ID |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |

**唯一约束**: (userId, contentType, contentId)

#### 3.2.9 订阅表 (Subscription)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| userId | UUID | FK, NOT NULL | 用户ID |
| type | VARCHAR(20) | NOT NULL | 订阅类型：keyword |
| keywords | TEXT[] | NOT NULL | 关键词列表 |
| contentTypes | TEXT[] | | 内容类型筛选 |
| isActive | BOOLEAN | DEFAULT TRUE | 是否启用 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.10 评论表 (Comment)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| userId | UUID | FK, NOT NULL | 用户ID |
| contentType | VARCHAR(20) | NOT NULL | 内容类型 |
| contentId | UUID | NOT NULL | 内容ID |
| content | TEXT | NOT NULL | 评论内容 |
| parentId | UUID | FK | 父评论ID |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |

#### 3.2.11 管理员表 (Admin)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| username | VARCHAR(50) | UNIQUE, NOT NULL | 用户名 |
| email | VARCHAR(255) | UNIQUE, NOT NULL | 邮箱 |
| passwordHash | VARCHAR(255) | NOT NULL | 密码哈希 |
| role | VARCHAR(20) | NOT NULL | 角色：super_admin, admin |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.12 邮箱验证表 (EmailVerification)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| email | VARCHAR(255) | NOT NULL | 邮箱 |
| code | VARCHAR(10) | NOT NULL | 验证码 |
| type | VARCHAR(20) | NOT NULL | 类型：register, reset_password |
| expiresAt | TIMESTAMP | NOT NULL | 过期时间 |
| used | BOOLEAN | DEFAULT FALSE | 是否已使用 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |

#### 3.2.13 密码重置表 (PasswordReset)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| email | VARCHAR(255) | NOT NULL | 邮箱 |
| token | VARCHAR(255) | UNIQUE, NOT NULL | 重置Token |
| expiresAt | TIMESTAMP | NOT NULL | 过期时间 |
| used | BOOLEAN | DEFAULT FALSE | 是否已使用 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |

#### 3.2.14 同步日志表 (SyncLog)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| type | VARCHAR(50) | NOT NULL | 同步类型 |
| status | VARCHAR(20) | NOT NULL | 状态：running, success, failed |
| message | TEXT | | 日志信息 |
| recordCount | INTEGER | | 同步记录数 |
| startedAt | TIMESTAMP | | 开始时间 |
| finishedAt | TIMESTAMP | | 结束时间 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |

#### 3.2.15 UP主表 (Uploader)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| mid | VARCHAR(50) | UNIQUE | B站用户ID |
| name | VARCHAR(100) | NOT NULL | UP主名称 |
| faceUrl | VARCHAR(500) | | 头像URL |
| followerCount | INTEGER | DEFAULT 0 | 粉丝数 |
| isActive | BOOLEAN | DEFAULT TRUE | 是否启用 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |
| updatedAt | TIMESTAMP | | 更新时间 |

#### 3.2.16 关键词表 (Keyword)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | UUID | PK | 主键 |
| type | VARCHAR(20) | NOT NULL | 类型：paper, video, resource |
| keyword | VARCHAR(100) | NOT NULL | 关键词 |
| isActive | BOOLEAN | DEFAULT TRUE | 是否启用 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 创建时间 |

---

## 四、API接口设计

### 4.1 API设计规范

#### 4.1.1 URL规范

```
基础URL: /api/v1

命名规范:
- 使用名词复数: /papers, /videos, /resources
- 使用小写字母和连字符: /email-verification
- 资源嵌套不超过2层: /papers/:id/comments

HTTP方法:
- GET    查询资源
- POST   创建资源
- PUT    更新资源(完整)
- PATCH  更新资源(部分)
- DELETE 删除资源
```

#### 4.1.2 请求响应格式

**成功响应**:
```json
{
  "code": 0,
  "message": "success",
  "data": { ... },
  "timestamp": 1708867200000
}
```

**分页响应**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [...],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 100,
      "totalPages": 5
    }
  },
  "timestamp": 1708867200000
}
```

**错误响应**:
```json
{
  "code": 400,
  "message": "参数错误",
  "error": "用户名不能为空",
  "timestamp": 1708867200000
}
```

### 4.2 公开API

#### 4.2.1 认证相关

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| POST | /api/v1/auth/register | 用户注册 | 否 |
| POST | /api/v1/auth/login | 用户登录 | 否 |
| POST | /api/v1/auth/logout | 用户登出 | 是 |
| POST | /api/v1/auth/refresh | 刷新Token | 是 |
| GET | /api/v1/auth/me | 当前用户信息 | 是 |

**POST /api/v1/auth/register**
```typescript
// Request
{
  username: string;      // 3-50字符
  email: string;         // 邮箱格式
  password: string;      // 8-50字符，包含字母和数字
  code: string;          // 6位验证码
}

// Response
{
  code: 0;
  data: {
    user: User;
    accessToken: string;
    refreshToken: string;
  }
}
```

**POST /api/v1/auth/login**
```typescript
// Request
{
  email: string;
  password: string;
}

// Response
{
  code: 0;
  data: {
    user: User;
    accessToken: string;
    refreshToken: string;
  }
}
```

#### 4.2.2 邮箱验证

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| POST | /api/v1/email-verification/send | 发送验证码 | 否 |
| POST | /api/v1/email-verification/verify | 验证验证码 | 否 |

**POST /api/v1/email-verification/send**
```typescript
// Request
{
  email: string;
  type: 'register' | 'reset_password';
}

// Response
{
  code: 0;
  message: '验证码已发送';
}
```

#### 4.2.3 密码重置

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| POST | /api/v1/password-reset/request | 请求重置 | 否 |
| POST | /api/v1/password-reset/confirm | 确认重置 | 否 |

#### 4.2.4 内容浏览

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/feed | 首页信息流 | 否 |
| GET | /api/v1/papers | 论文列表 | 否 |
| GET | /api/v1/papers/:id | 论文详情 | 否 |
| GET | /api/v1/videos | 视频列表 | 否 |
| GET | /api/v1/videos/:id | 视频详情 | 否 |
| GET | /api/v1/resources | 资源列表 | 否 |
| GET | /api/v1/resources/:id | 资源详情 | 否 |
| GET | /api/v1/news | 新闻列表 | 否 |
| GET | /api/v1/news/:id | 新闻详情 | 否 |
| GET | /api/v1/jobs | 职位列表 | 否 |
| GET | /api/v1/search | 全局搜索 | 否 |

**GET /api/v1/feed**
```typescript
// Query
{
  page?: number;       // 默认1
  pageSize?: number;   // 默认20，最大50
  type?: 'all' | 'paper' | 'video' | 'resource' | 'news' | 'job';
}

// Response
{
  code: 0;
  data: {
    items: FeedItem[];
    pagination: Pagination;
  }
}
```

**GET /api/v1/resources**
```typescript
// Query
{
  page?: number;
  pageSize?: number;
  type?: 'model' | 'dataset' | 'code' | 'simulation' | 'driver' | 'tutorial';
  subType?: string;    // 二级分类标签
  keyword?: string;
  sort?: 'latest' | 'stars';
}

// Response
{
  code: 0;
  data: {
    items: Resource[];
    pagination: Pagination;
  }
}
```

**GET /api/v1/search**
```typescript
// Query
{
  q: string;           // 搜索关键词
  type?: 'all' | 'paper' | 'video' | 'resource' | 'news';
  page?: number;
  pageSize?: number;
  sort?: 'relevance' | 'latest';
}

// Response
{
  code: 0;
  data: {
    items: SearchResult[];
    pagination: Pagination;
  }
}
```

### 4.3 用户API

#### 4.3.1 用户资料

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/user/profile | 获取个人资料 | 是 |
| PUT | /api/v1/user/profile | 更新个人资料 | 是 |
| PUT | /api/v1/user/password | 修改密码 | 是 |

#### 4.3.2 收藏功能

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/favorites | 收藏列表 | 是 |
| POST | /api/v1/favorites | 添加收藏 | 是 |
| DELETE | /api/v1/favorites/:id | 取消收藏 | 是 |

**POST /api/v1/favorites**
```typescript
// Request
{
  contentType: 'paper' | 'video' | 'resource' | 'news';
  contentId: string;
}

// Response
{
  code: 0;
  data: {
    id: string;
    createdAt: string;
  }
}
```

#### 4.3.3 订阅功能

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/subscriptions | 订阅列表 | 是 |
| POST | /api/v1/subscriptions | 创建订阅 | 是 |
| PUT | /api/v1/subscriptions/:id | 更新订阅 | 是 |
| DELETE | /api/v1/subscriptions/:id | 删除订阅 | 是 |

**POST /api/v1/subscriptions**
```typescript
// Request
{
  keywords: string[];           // 关键词列表
  contentTypes?: string[];      // 内容类型筛选
}

// Response
{
  code: 0;
  data: Subscription;
}
```

#### 4.3.4 评论功能

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/comments | 评论列表 | 否 |
| POST | /api/v1/comments | 发表评论 | 是 |
| DELETE | /api/v1/comments/:id | 删除评论 | 是 |

### 4.4 管理端API

#### 4.4.1 管理员认证

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| POST | /api/v1/admin/login | 管理员登录 | 否 |
| GET | /api/v1/admin/me | 当前管理员信息 | 是 |

#### 4.4.2 用户管理

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/admin/users | 用户列表 | admin |
| PUT | /api/v1/admin/users/:id | 更新用户 | admin |
| DELETE | /api/v1/admin/users/:id | 删除用户 | admin |

#### 4.4.3 管理员管理

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/admin/admins | 管理员列表 | super_admin |
| POST | /api/v1/admin/admins | 创建管理员 | super_admin |
| PUT | /api/v1/admin/admins/:id | 更新管理员 | super_admin |
| DELETE | /api/v1/admin/admins/:id | 删除管理员 | super_admin |

#### 4.4.4 内容管理

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/admin/content/papers | 论文管理列表 | admin |
| PUT | /api/v1/admin/content/papers/:id | 更新论文 | admin |
| DELETE | /api/v1/admin/content/papers/:id | 删除论文 | admin |
| GET | /api/v1/admin/content/videos | 视频管理列表 | admin |
| PUT | /api/v1/admin/content/videos/:id | 更新视频 | admin |
| DELETE | /api/v1/admin/content/videos/:id | 删除视频 | admin |
| GET | /api/v1/admin/content/resources | 资源管理列表 | admin |
| POST | /api/v1/admin/content/resources | 创建资源 | admin |
| PUT | /api/v1/admin/content/resources/:id | 更新资源 | admin |
| DELETE | /api/v1/admin/content/resources/:id | 删除资源 | admin |
| POST | /api/v1/admin/content/resources/:id/sources | 添加资源来源 | admin |
| DELETE | /api/v1/admin/content/resources/:id/sources/:sourceId | 删除资源来源 | admin |
| GET | /api/v1/admin/content/news | 新闻管理列表 | admin |
| POST | /api/v1/admin/content/news | 创建新闻 | admin |
| PUT | /api/v1/admin/content/news/:id | 更新新闻 | admin |
| DELETE | /api/v1/admin/content/news/:id | 删除新闻 | admin |
| GET | /api/v1/admin/content/jobs | 招聘管理列表 | admin |
| POST | /api/v1/admin/content/jobs | 创建职位 | admin |
| PUT | /api/v1/admin/content/jobs/:id | 更新职位 | admin |
| DELETE | /api/v1/admin/content/jobs/:id | 删除职位 | admin |

#### 4.4.5 数据同步

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| POST | /api/v1/admin/sync/arxiv | 同步ArXiv | admin |
| POST | /api/v1/admin/sync/github | 同步GitHub | admin |
| POST | /api/v1/admin/sync/bilibili | 同步B站 | admin |
| POST | /api/v1/admin/sync/huggingface | 同步HF | admin |
| GET | /api/v1/admin/sync/status | 同步状态 | admin |
| GET | /api/v1/admin/sync/logs | 同步日志 | admin |

#### 4.4.6 系统管理

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/admin/keywords | 关键词列表 | admin |
| POST | /api/v1/admin/keywords | 创建关键词 | admin |
| PUT | /api/v1/admin/keywords/:id | 更新关键词 | admin |
| DELETE | /api/v1/admin/keywords/:id | 删除关键词 | admin |
| GET | /api/v1/admin/uploaders | UP主列表 | admin |
| POST | /api/v1/admin/uploaders | 创建UP主 | admin |
| PUT | /api/v1/admin/uploaders/:id | 更新UP主 | admin |
| DELETE | /api/v1/admin/uploaders/:id | 删除UP主 | admin |
| GET | /api/v1/admin/scheduler | 定时任务列表 | admin |
| PUT | /api/v1/admin/scheduler/:id | 更新定时任务 | admin |

---

## 五、前端架构设计

### 5.1 目录结构

```
frontend/
├── public/                    # 静态资源
│   ├── favicon.ico
│   └── images/
├── src/
│   ├── app/                   # Next.js App Router
│   │   ├── (public)/          # 公开页面组
│   │   │   ├── page.tsx       # 首页
│   │   │   ├── papers/
│   │   │   ├── videos/
│   │   │   ├── resources/
│   │   │   ├── news/
│   │   │   ├── jobs/
│   │   │   ├── search/
│   │   │   ├── login/
│   │   │   ├── register/
│   │   │   └── forgot-password/
│   │   ├── (auth)/            # 需认证页面组
│   │   │   ├── profile/
│   │   │   ├── favorites/
│   │   │   └── subscriptions/
│   │   ├── admin/             # 管理端页面
│   │   │   ├── page.tsx
│   │   │   ├── login/
│   │   │   ├── users/
│   │   │   ├── admins/
│   │   │   ├── content/
│   │   │   ├── sync/
│   │   │   ├── scheduler/
│   │   │   └── keywords/
│   │   ├── layout.tsx
│   │   └── globals.css
│   ├── components/            # 公共组件
│   │   ├── ui/                # 基础UI组件
│   │   │   ├── Button/
│   │   │   ├── Card/
│   │   │   ├── Form/
│   │   │   └── ...
│   │   ├── layout/            # 布局组件
│   │   │   ├── Header/
│   │   │   ├── Footer/
│   │   │   ├── Sidebar/
│   │   │   └── ...
│   │   ├── content/           # 内容组件
│   │   │   ├── PaperCard/
│   │   │   ├── VideoCard/
│   │   │   ├── ResourceCard/
│   │   │   └── ...
│   │   └── business/          # 业务组件
│   │       ├── SearchBar/
│   │       ├── FilterPanel/
│   │       └── ...
│   ├── hooks/                 # 自定义Hooks
│   │   ├── useAuth.ts
│   │   ├── usePagination.ts
│   │   └── ...
│   ├── lib/                   # 工具库
│   │   ├── api/               # API客户端
│   │   │   ├── client.ts
│   │   │   ├── auth.ts
│   │   │   ├── content.ts
│   │   │   └── ...
│   │   ├── utils/             # 工具函数
│   │   └── constants/         # 常量定义
│   ├── stores/                # 状态管理
│   │   ├── authStore.ts
│   │   └── ...
│   └── types/                 # 类型定义
│       ├── api.ts
│       ├── models.ts
│       └── ...
├── .env.local
├── next.config.js
├── tailwind.config.js
├── tsconfig.json
└── package.json
```

### 5.2 状态管理

```typescript
// stores/authStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AuthState {
  user: User | null;
  accessToken: string | null;
  refreshToken: string | null;
  isAuthenticated: boolean;
  login: (user: User, accessToken: string, refreshToken: string) => void;
  logout: () => void;
  updateTokens: (accessToken: string, refreshToken: string) => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      accessToken: null,
      refreshToken: null,
      isAuthenticated: false,
      login: (user, accessToken, refreshToken) =>
        set({ user, accessToken, refreshToken, isAuthenticated: true }),
      logout: () =>
        set({ user: null, accessToken: null, refreshToken: null, isAuthenticated: false }),
      updateTokens: (accessToken, refreshToken) =>
        set({ accessToken, refreshToken }),
    }),
    {
      name: 'auth-storage',
    }
  )
);
```

### 5.3 API客户端

```typescript
// lib/api/client.ts
import axios from 'axios';
import { useAuthStore } from '@/stores/authStore';

const client = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || '/api/v1',
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
});

client.interceptors.request.use((config) => {
  const { accessToken } = useAuthStore.getState();
  if (accessToken) {
    config.headers.Authorization = `Bearer ${accessToken}`;
  }
  return config;
});

client.interceptors.response.use(
  (response) => response.data,
  async (error) => {
    if (error.response?.status === 401) {
      const { refreshToken, updateTokens, logout } = useAuthStore.getState();
      if (refreshToken) {
        try {
          const { data } = await axios.post('/api/v1/auth/refresh', {
            refreshToken,
          });
          updateTokens(data.accessToken, data.refreshToken);
          error.config.headers.Authorization = `Bearer ${data.accessToken}`;
          return client(error.config);
        } catch {
          logout();
        }
      }
    }
    return Promise.reject(error);
  }
);

export default client;
```

---

## 六、后端架构设计

### 6.1 目录结构

```
backend/
├── prisma/
│   ├── schema.prisma          # 数据库Schema
│   ├── migrations/            # 迁移文件
│   └── seed.ts                # 种子数据
├── src/
│   ├── config/                # 配置文件
│   │   ├── database.ts
│   │   ├── redis.ts
│   │   ├── jwt.ts
│   │   └── ...
│   ├── middleware/            # 中间件
│   │   ├── auth.ts            # JWT认证
│   │   ├── adminAuth.ts       # 管理员认证
│   │   ├── validate.ts        # 请求验证
│   │   ├── errorHandler.ts    # 错误处理
│   │   └── rateLimiter.ts     # 限流
│   ├── routes/                # 路由
│   │   ├── index.ts           # 路由入口
│   │   ├── auth.routes.ts
│   │   ├── user.routes.ts
│   │   ├── content.routes.ts
│   │   ├── search.routes.ts
│   │   ├── admin.routes.ts
│   │   └── ...
│   ├── services/              # 业务逻辑
│   │   ├── auth.service.ts
│   │   ├── user.service.ts
│   │   ├── paper.service.ts
│   │   ├── video.service.ts
│   │   ├── resource.service.ts
│   │   ├── news.service.ts
│   │   ├── job.service.ts
│   │   ├── search.service.ts
│   │   ├── sync.service.ts
│   │   └── ...
│   ├── queues/                # 任务队列
│   │   ├── index.ts
│   │   ├── sync.queue.ts
│   │   └── notify.queue.ts
│   ├── scripts/               # 脚本
│   │   ├── sync-arxiv.ts
│   │   ├── sync-github.ts
│   │   ├── sync-bilibili.ts
│   │   └── ...
│   ├── types/                 # 类型定义
│   │   ├── express.d.ts
│   │   └── models.ts
│   ├── utils/                 # 工具函数
│   │   ├── logger.ts
│   │   ├── password.ts
│   │   ├── jwt.ts
│   │   ├── email.ts
│   │   └── ...
│   └── app.ts                 # Express应用
├── tests/                     # 测试
├── .env
├── package.json
└── tsconfig.json
```

### 6.2 中间件设计

```typescript
// middleware/auth.ts
import { Request, Response, NextFunction } from 'express';
import { verifyToken } from '@/utils/jwt';
import { prisma } from '@/config/database';

export const authMiddleware = async (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  try {
    const authHeader = req.headers.authorization;
    if (!authHeader?.startsWith('Bearer ')) {
      return res.status(401).json({ code: 401, message: '未登录' });
    }

    const token = authHeader.split(' ')[1];
    const payload = verifyToken(token, 'access');
    
    const user = await prisma.user.findUnique({
      where: { id: payload.userId },
    });

    if (!user) {
      return res.status(401).json({ code: 401, message: '用户不存在' });
    }

    req.user = user;
    next();
  } catch (error) {
    return res.status(401).json({ code: 401, message: 'Token无效' });
  }
};
```

### 6.3 服务层设计

```typescript
// services/resource.service.ts
import { prisma } from '@/config/database';
import { ResourceType, ResourceSubType } from '@prisma/client';

export class ResourceService {
  async findAll(params: {
    page: number;
    pageSize: number;
    type?: ResourceType;
    subType?: ResourceSubType;
    keyword?: string;
    sort: 'latest' | 'stars';
  }) {
    const { page, pageSize, type, subType, keyword, sort } = params;
    const skip = (page - 1) * pageSize;

    const where: any = {};
    if (type) where.type = type;
    if (subType) where.subType = subType;
    if (keyword) {
      where.OR = [
        { title: { contains: keyword, mode: 'insensitive' } },
        { description: { contains: keyword, mode: 'insensitive' } },
      ];
    }

    const [items, total] = await Promise.all([
      prisma.resource.findMany({
        where,
        include: {
          sources: true,
        },
        orderBy: sort === 'stars' ? { stars: 'desc' } : { createdAt: 'desc' },
        skip,
        take: pageSize,
      }),
      prisma.resource.count({ where }),
    ]);

    return {
      items,
      pagination: {
        page,
        pageSize,
        total,
        totalPages: Math.ceil(total / pageSize),
      },
    };
  }

  async findById(id: string) {
    return prisma.resource.findUnique({
      where: { id },
      include: {
        sources: true,
      },
    });
  }

  async create(data: CreateResourceDTO) {
    const { sources, ...resourceData } = data;
    
    return prisma.resource.create({
      data: {
        ...resourceData,
        sources: {
          create: sources,
        },
      },
      include: {
        sources: true,
      },
    });
  }
}
```

---

## 七、安全设计

### 7.1 认证安全

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              认证安全设计                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   JWT双Token机制                                                             │
│   ├── Access Token                                                          │
│   │   ├── 有效期：15分钟                                                     │
│   │   ├── 存储：内存/React Query缓存                                        │
│   │   └── 用途：API请求认证                                                  │
│   │                                                                         │
│   └── Refresh Token                                                         │
│       ├── 有效期：7天                                                        │
│       ├── 存储：HttpOnly Cookie + Zustand持久化                             │
│       └── 用途：刷新Access Token                                            │
│                                                                             │
│   密码安全                                                                   │
│   ├── 加密算法：bcrypt                                                       │
│   ├── 加密轮数：12轮                                                         │
│   └── 密码规则：8-50字符，包含字母和数字                                      │
│                                                                             │
│   验证码安全                                                                 │
│   ├── 长度：6位数字                                                          │
│   ├── 有效期：10分钟                                                         │
│   ├── 发送频率：60秒/次                                                      │
│   └── 单邮箱每日上限：10次                                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.2 API安全

| 安全措施 | 说明 |
|----------|------|
| HTTPS | 强制HTTPS，HTTP自动跳转 |
| CORS | 白名单域名，携带凭证 |
| Rate Limiting | API限流：100次/分钟/IP |
| Input Validation | Zod验证所有输入 |
| SQL Injection | Prisma参数化查询 |
| XSS | React自动转义 + DOMPurify |
| CSRF | SameSite Cookie + CSRF Token |

### 7.3 权限控制

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              权限控制矩阵                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   用户角色                                                                   │
│   ├── user      普通用户                                                    │
│   │   └── 浏览内容、收藏、订阅、评论                                         │
│   │                                                                         │
│   └── vip      VIP用户                                                      │
│       └── 普通用户权限 + 高级功能（预留）                                     │
│                                                                             │
│   管理员角色                                                                 │
│   ├── admin      普通管理员                                                 │
│   │   └── 内容管理 + 用户管理 + 同步管理                                     │
│   │                                                                         │
│   └── super_admin 超级管理员                                                │
│       └── 全部权限 + 管理员管理                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 八、性能设计

### 8.1 前端性能

| 指标 | 目标 | 优化措施 |
|------|------|----------|
| FCP | < 1.5s | SSR/SSG、关键CSS内联 |
| LCP | < 2.5s | 图片懒加载、预加载关键资源 |
| CLS | < 0.1 | 骨架屏、固定尺寸 |
| FID | < 100ms | 代码分割、延迟加载 |

### 8.2 后端性能

| 指标 | 目标 | 优化措施 |
|------|------|----------|
| API响应(P95) | < 300ms | 数据库索引、Redis缓存 |
| 并发支持 | 100 QPS | 连接池、异步处理 |
| 数据库查询 | < 50ms | 索引优化、查询优化 |

### 8.3 缓存策略

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              缓存策略                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Redis缓存                                                                  │
│   ├── 内容列表缓存                                                           │
│   │   ├── Key: content:{type}:page:{page}                                  │
│   │   ├── TTL: 5分钟                                                        │
│   │   └── 策略：LRU                                                         │
│   │                                                                         │
│   ├── 搜索结果缓存                                                           │
│   │   ├── Key: search:{query}:{type}                                       │
│   │   ├── TTL: 10分钟                                                       │
│   │   └── 策略：LRU                                                         │
│   │                                                                         │
│   └── 用户Session                                                            │
│       ├── Key: session:{userId}                                            │
│       ├── TTL: 7天                                                          │
│       └── 策略：TTL                                                         │
│                                                                             │
│   浏览器缓存                                                                  │
│   ├── 静态资源：1年（带Hash）                                                │
│   ├── HTML页面：不缓存（SSR）                                                │
│   └── API响应：不缓存                                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 九、部署架构

### 9.1 部署架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              部署架构                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                           用户请求                                   │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                      │                                      │
│                                      ▼                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        CDN / 静态资源                                 │  │
│   │                    (Cloudflare / 阿里云CDN)                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                      │                                      │
│                                      ▼                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        Nginx 反向代理                                 │  │
│   │                    (负载均衡 + SSL终止)                               │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                      │                                      │
│                    ┌─────────────────┼─────────────────┐                   │
│                    ▼                 ▼                 ▼                   │
│   ┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐ │
│   │   Frontend (Next)   │ │   Backend (Express) │ │   Admin (Next)      │ │
│   │   Port: 3000        │ │   Port: 3001        │ │   Port: 3002        │ │
│   └─────────────────────┘ └─────────────────────┘ └─────────────────────┘ │
│                                      │                                      │
│                    ┌─────────────────┼─────────────────┐                   │
│                    ▼                 ▼                 ▼                   │
│   ┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐ │
│   │    PostgreSQL       │ │       Redis         │ │     文件存储        │ │
│   │    Port: 5432       │ │    Port: 6379       │ │    (OSS/本地)       │ │
│   └─────────────────────┘ └─────────────────────┘ └─────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 9.2 Docker配置

```yaml
# docker-compose.yml
version: '3.8'

services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://backend:3001/api/v1
    depends_on:
      - backend

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/embodied_pulse
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=${JWT_SECRET}
      - JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:15-alpine
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=embodied_pulse
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - frontend
      - backend

volumes:
  postgres_data:
  redis_data:
```

---

## 附录

### A. 环境变量

```bash
# 后端环境变量
DATABASE_URL=postgresql://user:password@localhost:5432/embodied_pulse
REDIS_URL=redis://localhost:6379
JWT_SECRET=your-jwt-secret
JWT_REFRESH_SECRET=your-refresh-secret
SMTP_HOST=smtp.example.com
SMTP_USER=noreply@example.com
SMTP_PASS=your-smtp-password

# 前端环境变量
NEXT_PUBLIC_API_URL=http://localhost:3001/api/v1
```

### B. 数据库索引

```sql
-- 用户表索引
CREATE INDEX idx_user_email ON "User"(email);
CREATE INDEX idx_user_username ON "User"(username);

-- 论文表索引
CREATE INDEX idx_paper_arxiv_id ON "Paper"(arxivId);
CREATE INDEX idx_paper_published_at ON "Paper"(publishedAt DESC);
CREATE INDEX idx_paper_citation_count ON "Paper"(citationCount DESC);

-- 视频表索引
CREATE INDEX idx_video_bvid ON "Video"(bvid);
CREATE INDEX idx_video_uploader_id ON "Video"(uploaderId);
CREATE INDEX idx_video_play_count ON "Video"(playCount DESC);

-- 资源表索引
CREATE INDEX idx_resource_type ON "Resource"(type);
CREATE INDEX idx_resource_sub_type ON "Resource"(subType);
CREATE INDEX idx_resource_stars ON "Resource"(stars DESC);

-- 收藏表索引
CREATE INDEX idx_favorite_user_id ON "Favorite"(userId);
CREATE INDEX idx_favorite_content ON "Favorite"(contentType, contentId);

-- 订阅表索引
CREATE INDEX idx_subscription_user_id ON "Subscription"(userId);
CREATE INDEX idx_subscription_active ON "Subscription"(isActive);
```

---

**文档版本**: v1.0
**创建日期**: 2026-02-25
**最后更新**: 2026-02-25
**维护人**: AI助手团队
